<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-127329943-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Frank&#39;s development blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Frank&apos;s development blog - Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights">
<meta name="keywords" content="Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights">
<meta property="og:type" content="website">
<meta property="og:title" content="Frank&#39;s development blog">
<meta property="og:url" content="https://yfrankfeng.github.io/index.html">
<meta property="og:site_name" content="Frank&#39;s development blog">
<meta property="og:description" content="Frank&apos;s development blog - Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Frank&#39;s development blog">
<meta name="twitter:description" content="Frank&apos;s development blog - Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights">
  
    <link rel="alternate" href="/atom.xml" title="Frank&#39;s development blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Frank&#39;s development blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://yfrankfeng.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-yodl-migration" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/yodl-migration/" class="article-date">
  <time datetime="2020-04-16T11:13:02.555Z" itemprop="datePublished">2020-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/yodl-migration/">YODL migration</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><p>While installed Tomcat via apt, use the following steps to run tomcat service under dlib user:</p>
        
          <p class="article-more-link">
            <a href="/yodl-migration/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/yodl-migration/" data-id="ck48pp4x40001j5058vjxad2a" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fedora/">Fedora</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Solr/">Solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ruby-rest-api" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/ruby-rest-api/" class="article-date">
  <time datetime="2020-02-21T12:17:34.473Z" itemprop="datePublished">2020-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ruby/">ruby</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/ruby-rest-api/">Build Rest API in Ruby</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Followed tutorial in: <a href="https://scotch.io/tutorials/build-a-restful-json-api-with-rails-5-part-one" target="_blank" rel="noopener">https://scotch.io/tutorials/build-a-restful-json-api-with-rails-5-part-one</a></p>
<h2 id="Create-project"><a href="#Create-project" class="headerlink" title="Create project"></a>Create project</h2><p>rails new todos-api –api -T</p>
<p>–api argument to tell Rails that we want an API application<br>-T to exclude Minitest the default testing framework.<br>Don’t freak out, we’re going to write tests. We’ll be using RSpec instead to test our API. I find RSpec to be more expressive and easier to start with as compared to Minitest.</p>
<h2 id="Add-dependencies"><a href="#Add-dependencies" class="headerlink" title="Add dependencies"></a>Add dependencies</h2><p>In Gemfile, add:</p>
<pre><code>group :development, :test do
  gem &apos;byebug&apos;, platforms: [:mri, :mingw, :x64_mingw]
  gem &apos;rspec-rails&apos;
end
</code></pre><p>and</p>
<pre><code>group :test do
  gem &apos;factory_bot_rails&apos;, &apos;~&gt; 4.0&apos;
  gem &apos;shoulda-matchers&apos;, &apos;~&gt; 3.1&apos;
  gem &apos;faker&apos;
  gem &apos;database_cleaner&apos;
end
</code></pre><p>Run </p>
<pre><code>bundle install
</code></pre><h2 id="Get-test-folders-ready"><a href="#Get-test-folders-ready" class="headerlink" title="Get test folders ready"></a>Get test folders ready</h2><p>Initialize the spec folder:</p>
<pre><code>rails g rspec:install
</code></pre><p>Create a factories folder, where we will define the model factories.</p>
<pre><code>mkdir spec/factories
</code></pre><p>Edit spec/rails_helper.rb</p>
<pre><code>require &apos;database_cleaner&apos;
</code></pre><p>and</p>
<pre><code># configure shoulda matchers to use rspec as the test framework and full matcher libraries for rails
Shoulda::Matchers.configure do |config|
  config.integrate do |with|
    with.test_framework :rspec
    with.library :rails
  end
end
</code></pre><p>and</p>
<p>Under RSpec.configure do |config|,</p>
<pre><code>config.include FactoryBot::Syntax::Methods

# start by truncating all the tables but then use the faster transaction strategy the rest of the time.
config.before(:suite) do
  DatabaseCleaner.clean_with(:truncation)
  DatabaseCleaner.strategy = :transaction
end        

# start the transaction strategy as examples are run
config.around(:each) do |example|
  DatabaseCleaner.cleaning do
    example.run
  end
end        
</code></pre><h2 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h2><p>Generate Todo model:</p>
<pre><code>rails g model Todo title:string created_by:string
</code></pre><p>Notice that we’ve included the model attributes in the model generation command. This way we don’t have to edit the migration file. The generator invokes active record and rspec to generate the migration, model, and spec respectively.</p>
<pre><code>rails g model Item name:string done:boolean todo:references
</code></pre><p>Run</p>
<pre><code>rails db:migrate
</code></pre><h2 id="Test-the-model"><a href="#Test-the-model" class="headerlink" title="Test the model"></a>Test the model</h2><p>Edit spec/models/todo_spec.rb:</p>
<pre><code>RSpec.describe Todo, type: :model do
  # ensure Todo model has a 1:m relationship with the Item model
  it { should have_many(:items).dependent(:destroy) }
  # Validation tests
  # ensure columns title and created_by are present before saving
  it { should validate_presence_of(:title) }
  it { should validate_presence_of(:created_by) }
end
</code></pre><p>Edit spec/models/item_spec.rb</p>
<pre><code>RSpec.describe Item, type: :model do
  # Association test
  # ensure an item record belongs to a single todo record
  it { should belong_to(:todo) }
  # Validation test
  # ensure column name is present before saving
  it { should validate_presence_of(:name) }
end
</code></pre><p>Run test:</p>
<pre><code>bundle exec rspec
</code></pre><p>It will fails:</p>
<pre><code>→  todos-api git:(master) bundle exec rspec
.FFFF
</code></pre><p>Let’s fix it.</p>
<p>Edit app/models/todo.rb:</p>
<pre><code>class Todo &lt; ApplicationRecord
    # model association
    has_many :items, dependent: :destroy

    # validations
    validates_presence_of :title, :created_by
end
</code></pre><p>Edit app/models/item.rb:</p>
<pre><code>class Item &lt; ApplicationRecord
  belongs_to :todo

  # validation
  validates_presence_of :name
end
</code></pre><p>Run test again</p>
<pre><code>bundle exec rspec
</code></pre><h2 id="Controllers"><a href="#Controllers" class="headerlink" title="Controllers"></a>Controllers</h2><p>Run:</p>
<pre><code>rails g controller Todos
rails g controller Items
</code></pre><p>Add a requests folder to spec folder with corresponding spec files:</p>
<pre><code>mkdir spec/requests &amp;&amp; touch spec/requests/{todos_spec.rb,items_spec.rb} 
</code></pre><p>Add factories file:</p>
<pre><code>touch spec/factories/{todos.rb,items.rb}            
</code></pre><p>Add content to spec/factories/todos.rb:</p>
<pre><code># spec/factories/todos.rb
FactoryBot.define do
  factory :todo do
    title { Faker::Lorem.word }
    created_by { Faker::Number.number(10) }
  end
end
</code></pre><p>and add content to spec/factories/items.rb:</p>
<pre><code># spec/factories/items.rb
FactoryBot.define do
  factory :item do
    name { Faker::StarWars.character }
    done false
    todo_id nil
  end
end
</code></pre><p>By wrapping faker methods in a block, we ensure that faker generates dynamic data every time the factory is invoked. This way, we always have unique data.</p>
<p>Edit spec/requests/todos_spec.rb:</p>
<pre><code># spec/requests/todos_spec.rb
require &apos;rails_helper&apos;

RSpec.describe &apos;Todos API&apos;, type: :request do
    # initialize test data
    let!(:todos) { create_list(:todo, 10) }
    let(:todo_id) { todos.first.id }

    # Test suite for GET /todos
    describe &apos;GET /todos&apos; do
        # make HTTP get request before each example
        before { get &apos;/todos&apos; }

        it &apos;returns todos&apos; do
            # Note `json` is a custom helper to parse JSON responses
            expect(json).not_to be_empty
            expect(json.size).to eq(10)
        end

        it &apos;returns status code 200&apos; do
            expect(response).to have_http_status(200)
        end
    end

    # Test suite for GET /todos/:id
    describe &apos;GET /todos/:id&apos; do
        before { get &quot;/todos/#{todo_id}&quot; }

        context &apos;when the record exists&apos; do
            it &apos;returns the todo&apos; do
                expect(json).not_to be_empty
                expect(json[&apos;id&apos;]).to eq(todo_id)
            end

            it &apos;returns status code 200&apos; do
                expect(response).to have_http_status(200)
            end
        end

        context &apos;when the record does not exist&apos; do
            let(:todo_id) { 100 }

            it &apos;returns status code 404&apos; do
                expect(response).to have_http_status(404)
            end

            it &apos;returns a not found message&apos; do
                expect(response.body).to match(/Couldn&apos;t find Todo/)
            end
        end
    end

    # Test suite for POST /todos
    describe &apos;POST /todos&apos; do
        # valid payload
        let(:valid_attributes) { { title: &apos;Learn Elm&apos;, created_by: &apos;1&apos; } }

        context &apos;when the request is valid&apos; do
            before { post &apos;/todos&apos;, params: valid_attributes }

            it &apos;creates a todo&apos; do
                expect(json[&apos;title&apos;]).to eq(&apos;Learn Elm&apos;)
            end

            it &apos;returns status code 201&apos; do
                expect(response).to have_http_status(201)
            end
        end

        context &apos;when the request is invalid&apos; do
            before { post &apos;/todos&apos;, params: { title: &apos;Foobar&apos; } }

            it &apos;returns status code 422&apos; do
                expect(response).to have_http_status(422)
            end

            it &apos;returns a validation failure message&apos; do
                expect(response.body)
                    .to match(/Validation failed: Created by can&apos;t be blank/)
            end
        end
    end

    # Test suite for PUT /todos/:id
    describe &apos;PUT /todos/:id&apos; do
        let(:valid_attributes) { { title: &apos;Shopping&apos; } }

        context &apos;when the record exists&apos; do
            before { put &quot;/todos/#{todo_id}&quot;, params: valid_attributes }

            it &apos;updates the record&apos; do
                expect(response.body).to be_empty
            end

            it &apos;returns status code 204&apos; do
                expect(response).to have_http_status(204)
            end
        end
    end

    # Test suite for DELETE /todos/:id
    describe &apos;DELETE /todos/:id&apos; do
        before { delete &quot;/todos/#{todo_id}&quot; }

        it &apos;returns status code 204&apos; do
            expect(response).to have_http_status(204)
        end
    end
end
</code></pre><p>We start by populating the database with a list of 10 todo records (thanks to factory bot). We also have a custom helper method json which parses the JSON response to a Ruby Hash which is easier to work with in our tests. Let’s define it in spec/support/request_spec_helper.</p>
<pre><code>mkdir spec/support &amp;&amp; touch spec/support/request_spec_helper.rb
</code></pre><p>Edit spec/support/request_spec_helper.rb:</p>
<pre><code># spec/support/request_spec_helper
module RequestSpecHelper
  # Parse JSON response to ruby hash
  def json
    JSON.parse(response.body)
  end
end
</code></pre><p>The support directory is not autoloaded by default. To enable this, open the rails helper and comment out the support directory auto-loading and then include it as shared module for all request specs in the RSpec configuration block.</p>
<p>Edit spec/rails_helper.rb:</p>
<pre><code>Dir[Rails.root.join(&apos;spec/support/**/*.rb&apos;)].each { |f| require f }
# [...]
RSpec.configuration do |config|
  # [...]
  config.include RequestSpecHelper, type: :request
  # [...]
end
</code></pre><p>Run the test:</p>
<pre><code>bundle exec rspec
</code></pre><p>We get failing routing errors. This is because we haven’t defined the routes yet. Go ahead and define them in config/routes.rb.</p>
<p>Edit config/routes.rb</p>
<pre><code># config/routes.rb
Rails.application.routes.draw do
  resources :todos do
    resources :items
  end
end
</code></pre><p>In our route definition, we’re creating todo resource with a nested items resource. This enforces the 1:m (one to many) associations at the routing level. To view the routes, you can run:</p>
<pre><code>rails routes
</code></pre><p>Edit app/controllers/todos_controller.rb:</p>
<pre><code># app/controllers/todos_controller.rb
class TodosController &lt; ApplicationController
  before_action :set_todo, only: [:show, :update, :destroy]

  # GET /todos
  def index
    @todos = Todo.all
    json_response(@todos)
  end

  # POST /todos
  def create
    @todo = Todo.create!(todo_params)
    json_response(@todo, :created)
  end

  # GET /todos/:id
  def show
    json_response(@todo)
  end

  # PUT /todos/:id
  def update
    @todo.update(todo_params)
    head :no_content
  end

  # DELETE /todos/:id
  def destroy
    @todo.destroy
    head :no_content
  end

  private

  def todo_params
    # whitelist params
    params.permit(:title, :created_by)
  end

  def set_todo
    @todo = Todo.find(params[:id])
  end
end
</code></pre><p>Add file: app/controllers/concerns/response.rb:</p>
<pre><code># app/controllers/concerns/response.rb
module Response
  def json_response(object, status = :ok)
    render json: object, status: status
  end
end
</code></pre><p>set_todo - callback method to find a todo by id. In the case where the record does not exist, ActiveRecord will throw an exception ActiveRecord::RecordNotFound. We’ll rescue from this exception and return a 404 message.            </p>
<p>Add file: app/controllers/concerns/exception_handler.rb:</p>
<pre><code># app/controllers/concerns/exception_handler.rb
module ExceptionHandler
  # provides the more graceful `included` method
  extend ActiveSupport::Concern

  included do
    rescue_from ActiveRecord::RecordNotFound do |e|
      json_response({ message: e.message }, :not_found)
    end

    rescue_from ActiveRecord::RecordInvalid do |e|
      json_response({ message: e.message }, :unprocessable_entity)
    end
  end
end
</code></pre><p>In our create method in the TodosController, note that we’re using create! instead of create. This way, the model will raise an exception ActiveRecord::RecordInvalid. This way, we can avoid deep nested if statements in the controller. Thus, we rescue from this exception in the ExceptionHandler module.    </p>
<p>However, our controller classes don’t know about these helpers yet. Let’s fix that by including these modules in the application controller.</p>
<pre><code># app/controllers/application_controller.rb
class ApplicationController &lt; ActionController::API
  include Response
  include ExceptionHandler
end
</code></pre><p>Run test:</p>
<pre><code>bundle exec rspec
</code></pre><p>It should pass.</p>
<h2 id="Manual-test"><a href="#Manual-test" class="headerlink" title="Manual test"></a>Manual test</h2><p>Install httpie to test:</p>
<pre><code>sudo apt-get install httpie
</code></pre><p>Run tests:</p>
<pre><code>http :3000/todos
http POST :3000/todos title=Mozart created_by=1
http PUT :3000/todos/1 title=Beethoven
http DELETE :3000/todos/1
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/ruby-rest-api/" data-id="ck92o0m3s000kky05sjmu7lrs" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rest-api/">rest api</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-tomcat-over-apache2" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/tomcat-over-apache2/" class="article-date">
  <time datetime="2020-02-21T11:10:34.354Z" itemprop="datePublished">2020-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/tomcat-over-apache2/">Serve Tomcat application over Apache2 and SSL</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Only-for-testing-Self-signed-SSL-certificate"><a href="#Only-for-testing-Self-signed-SSL-certificate" class="headerlink" title="(Only for testing) Self-signed SSL certificate"></a>(Only for testing) Self-signed SSL certificate</h2><p>For test purpose, you may want to create self signed certificate, so run:</p>
<pre><code>openssl req -new &gt; new.ssl.csr
</code></pre><p>With the following inputs:</p>
<pre><code>Country Name (2 letter code) [AU]: GB
State or Province Name (full name) [Some-State]: York
Locality Name (eg, city) []: York
Organization Name (eg, company) [Internet Widgits Pty Ltd]: University of York
Organizational Unit Name (eg, section) []: 
Common Name (eg, YOUR name) []:First and Last Name
Email Address []:Work Email

Please enter the following &apos;extra&apos; attributes
to be sent with your certificate request
A challenge password []: **Leave Blank**
An optional company name []:Optional
</code></pre><p>Then run commands:</p>
<pre><code>sudo openssl rsa -in privkey.pem -out new.cert.key
sudo openssl x509 -in new.ssl.csr -out new.cert.cert -req -signkey new.cert.key -days 365
sudo cp new.cert.cert /etc/apache2/ssl/server.crt
sudo cp new.cert.key /etc/apache2/ssl/server.key
</code></pre><p>The above server.crt and server.key can be used in apache2.</p>
<h2 id="Put-the-real-SSL-certificate-files-in-place"><a href="#Put-the-real-SSL-certificate-files-in-place" class="headerlink" title="Put the real SSL certificate files in place"></a>Put the real SSL certificate files in place</h2><p>The files required are:</p>
<pre><code>/etc/apache2/ssl/www.example.com.crt
/etc/apache2/ssl/www.example.com.pem
</code></pre><h2 id="Apache-configuration"><a href="#Apache-configuration" class="headerlink" title="Apache configuration"></a>Apache configuration</h2><pre><code>apt install tomcat8 tomcat8-admin apache2 libapache2-mod-jk
a2enmod ssl
a2enmod rewrite
a2enmod headers
</code></pre><p>Run command:</p>
<pre><code>sudo nano /etc/apache2/sites-available/example-ssl.conf
</code></pre><p>With content:</p>
<pre><code>&lt;IfModule mod_ssl.c&gt;
    SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite          ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AE$
    SSLHonorCipherOrder     on
    SSLCompression          off
    &lt;VirtualHost *:443&gt;
        ServerAdmin YOUR_EMAIL
        ServerName www.example.com
        JkMount /example_app worker1
        JkMount /example_app/* worker1
        RedirectMatch ^/$ /example_app/
        SSLEngine on
        SSLCertificateFile /etc/apache2/ssl/www.example.com.crt
        SSLCertificateKeyFile /etc/apache2/ssl/www.example.com.pem
        # HSTS (mod_headers is required) (15768000 seconds = 6 months)
        Header always set Strict-Transport-Security &quot;max-age=15768000&quot;
    &lt;/VirtualHost&gt;
&lt;/IfModule&gt;
</code></pre><p>Edit file /etc/apache2/sites-available/example-non-ssl.conf with content:</p>
<pre><code>&lt;VirtualHost *:80&gt;
  ServerAdmin YOUR_EMAIL
  ServerName www.example.com
  RedirectMatch / https://www.example.com/$1
&lt;/VirtualHost&gt;
</code></pre><p>Run:</p>
<pre><code>a2ensite example-non-ssl
a2ensite example-ssl
a2dissite 000-default
a2dissite default-ssl
</code></pre><h2 id="Tomcat-configuration"><a href="#Tomcat-configuration" class="headerlink" title="Tomcat configuration"></a>Tomcat configuration</h2><p>Edit /etc/tomcat8/server.xml:</p>
<p>Comment out:</p>
<pre><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;
           connectionTimeout=&quot;20000&quot;
           redirectPort=&quot;8443&quot; /&gt;    
</code></pre><p>add:</p>
<pre><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;
           connectionTimeout=&quot;60000&quot;
           maxThreads=&quot;400&quot;
           URIEncoding=&quot;UTF-8&quot;
           redirectPort=&quot;8443&quot;/&gt;
</code></pre><p>add:</p>
<pre><code>&lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;
&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot;  maxthreads=&quot;400&quot; connectionTimeout=&quot;6000&quot; tomcatAuthentication=&quot;false&quot;/&gt;
</code></pre><p>Edit file: /etc/libapache2-mod-jk/workers.properties with content:</p>
<pre><code>workers.tomcat_home=/usr/share/tomcat8
workers.java_home=/usr/lib/jvm/default-java
ps=/

worker.list=worker1
worker.worker1.port=8009
worker.worker1.host=localhost
worker.worker1.type=ajp13
</code></pre><h2 id="peer-not-authenticated-problem"><a href="#peer-not-authenticated-problem" class="headerlink" title="peer not authenticated problem"></a>peer not authenticated problem</h2><p>Error message:</p>
<pre><code>javax.net.ssl.SSLPeerUnverifiedException: peer not authenticated                                    
        at java.base/sun.security.ssl.SSLSessionImpl.getPeerCertificates(SSLSessionImpl.java:558)
</code></pre><p>Reason: incorrect SSL certificate.            </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/tomcat-over-apache2/" data-id="ck92o0m1q0004ky05bnzzx5r1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSL/">SSL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iris-migration" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/iris-migration/" class="article-date">
  <time datetime="2020-01-29T16:27:38.305Z" itemprop="datePublished">2020-01-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/iris-migration/">IRIS migration</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Hard-coded-fedora-URL"><a href="#Hard-coded-fedora-URL" class="headerlink" title="Hard-coded fedora URL"></a>Hard-coded fedora URL</h2><p>In src/main/java/uk/ac/york/dlib/yodling/service/repository/FedoraAPIMEndpoint.java, there are lots of hard-coded Fedora URL (localhost:880/fedora/objects) </p>
<p>In src/main/java/uk/ac/york/dlib/yodling/web/workflow/WorkflowController.java, between about L1454-L1482, and other places within that file.</p>
<h2 id="hard-coded-Solr-URL"><a href="#hard-coded-Solr-URL" class="headerlink" title="hard-coded Solr URL"></a>hard-coded Solr URL</h2><p>In src/main/java/uk/ac/york/dlib/yodling/service/search/SolrSearchService.java, solr is hard-coded:</p>
<pre><code>private static String pathToSolr = &quot;http://localhost:8080/solr/&quot;;
</code></pre><p>Now we need to turn this attribute to non-static, and use Spring to inject the Solr URL.</p>
<p>First, declare the attribute as:</p>
<pre><code>private String pathToSolr = &quot;http://localhost:8080/solr/&quot;;
</code></pre><p>Add constructors:</p>
<pre><code>public SolrSearchService() {
}

public SolrSearchService(String pathToSolr) {
    try {
        if(pathToSolr != null)
            this.pathToSolr   = pathToSolr;
        solrSearchServer  = new CommonsHttpSolrServer(this.pathToSolr);
    } catch (Exception e) {
        log.error(&quot;Exception while connecting to Solr&quot;, e);
    }
}
</code></pre><p>In Spring config file, e.g. web-application-config.xml, define:</p>
<pre><code>&lt;bean id=&quot;homeSearchService&quot; class=&quot;uk.ac.york.dlib.yodling.service.search.SolrSearchService&quot;   scope=&quot;prototype&quot;&gt;
    &lt;constructor-arg name=&quot;pathToSolr&quot; value=&quot;${solr.baseURL}&quot; /&gt;

    XXXXXXXXXXXX
&lt;/bean&gt;                
</code></pre><p> In yodl.properties, add:</p>
<pre><code>solr.baseURL=https://XXXX/solr
</code></pre><h2 id="hard-coded-XSLT-path"><a href="#hard-coded-XSLT-path" class="headerlink" title="hard coded XSLT path"></a>hard coded XSLT path</h2><pre><code>src/main/webapp/Content/xslt/downloadersorter.xsl
src/main/webapp/Content/xslt/iris2dc.xsl
src/main/webapp/Content/xslt/irisData4EmailAlerts.xsl
src/main/webapp/Content/xslt/updateDownloadCountPerInsType.xsl
src/main/webapp/Content/xslt/updatePreDataTypes.xsl
src/main/webapp/Content/xslt/updateDownloadCountPerRA.xsl
src/main/webapp/Content/xslt/updatePreDomainOfUse.xsl
src/main/webapp/Content/xslt/updatePreFunders.xsl
src/main/webapp/Content/xslt/updatePreInsType.xsl
src/main/webapp/Content/xslt/updatePreJournals.xsl
src/main/webapp/Content/xslt/updatePreLinguisticTargets.xsl
src/main/webapp/Content/xslt/updatePreParticipantTypes.xsl
src/main/webapp/Content/xslt/updatePreProficiencies.xsl
src/main/webapp/Content/xslt/updatePrePublishers.xsl
src/main/webapp/Content/xslt/updatePreRequired_software.xsl
src/main/webapp/Content/xslt/updatePreResearchAreas.xsl
</code></pre><p>Change all absolute paths to DD to something like:</p>
<pre><code>&lt;xsl:variable name=&quot;commonsDD&quot;  select=&quot;document(&apos;../xml/datadictionary/commons.xml&apos;, /)&quot;/&gt;
</code></pre><h2 id="Improvements"><a href="#Improvements" class="headerlink" title="Improvements"></a>Improvements</h2><h3 id="duplicated-web-xml-in-Tomcat-webapp-folders"><a href="#duplicated-web-xml-in-Tomcat-webapp-folders" class="headerlink" title="duplicated web.xml in Tomcat webapp folders"></a>duplicated web.xml in Tomcat webapp folders</h3><p>In pom.xml</p>
<pre><code>&lt;build&gt;
        &lt;sourceDirectory&gt;${basedir}/src/main/java&lt;/sourceDirectory&gt;
        &lt;outputDirectory&gt;${project.build.directory}/WebRoot/WEB-INF/classes&lt;/outputDirectory&gt;
        &lt;resources&gt;
            ......
            &lt;resource&gt;
                &lt;directory&gt;src/main/resources&lt;/directory&gt;
                &lt;excludes&gt;
                    &lt;exclude&gt;**/*.properties&lt;/exclude&gt;
                    &lt;exclude&gt;**/*web-application-config.xml&lt;/exclude&gt;
                    &lt;exclude&gt;**/*web.xml&lt;/exclude&gt;
                &lt;/excludes&gt;
            &lt;/resource&gt;
        &lt;/resources&gt;   
......
&lt;/build&gt;         
</code></pre><h2 id="Orbeon-Engine"><a href="#Orbeon-Engine" class="headerlink" title="Orbeon Engine"></a>Orbeon Engine</h2><p>Download Orbeon 3.9 CE and extract the orbeon39.war. Stop Tomcat, Copy orbeon39.war to webapps, and Start Tomcat.</p>
<p>Edit Tomcat server.xml</p>
<pre><code>&lt;Host name=&quot;localhost&quot;  ...&gt;
    &lt;Context path=&quot;/orbeon39&quot; docBase=&quot;orbeon39&quot; crossContext=&quot;true&quot;/&gt;
    &lt;Context path=&quot;/iris&quot; docBase=&quot;iris&quot; crossContext=&quot;true&quot;/&gt;
</code></pre><p>Tried Orbeon 2019 CE but couldn’t get it working. The error message is not very useful:</p>
<p><img src="https://user-images.githubusercontent.com/437701/70224943-03601700-1746-11ea-8803-34824f3c3cf4.png" alt="image"></p>
<pre><code>2019-12-05 09:58:40,993 ERROR PageFlowControllerProcessor  - error caught {controller: &quot;oxf:/ops/xforms/xforms-renderer-pa$
2019-12-05 09:58:41,095 ERROR PageFlowControllerProcessor  -
+----------------------------------------------------------------------------------------------------------------------+
|An Error has Occurred                                                                                                 |
|----------------------------------------------------------------------------------------------------------------------|
|specified pattern is invalid: &apos;-&apos; is an invalid character range. Write &apos;\-&apos;.                                          |
|----------------------------------------------------------------------------------------------------------------------|
|Application Call Stack                                                                                                |
|----------------------------------------------------------------------------------------------------------------------|
|oxf:/ops/xforms/xforms-renderer-page-flow.xml                                     |reading page model data output|  23|
|····························································�$
|element=&lt;page path=&quot;/xforms-renderer&quot; model=&quot;xforms-renderer.xpl&quot;/&gt;                                                   |
|model  =xforms-renderer.xpl                                                                                           |
|----------------------------------------------------------------------------------------------------------------------|
|oxf:/ops/xforms/xforms-renderer.xpl                                               |executing processor           | 130|        
</code></pre><h2 id="logging-dependency-problem"><a href="#logging-dependency-problem" class="headerlink" title="logging dependency problem"></a>logging dependency problem</h2><p>The web app, e.g. iris working on local VM (Tomcat 9) but cannot start on dlibjavatest0 (Tomcat 8), and the error message is:</p>
<pre><code>17:08:12.571 SEVERE [http-nio-8080-exec-2] org.apache.catalina.core.StandardContext.listenerStart Exception sending context initialized event to listener instance of class [org.springframework.web.context.ContextLoaderListener]
java.lang.AbstractMethodError: Receiver class ch.qos.logback.classic.Logger does not define or inherit an implementation of the resolved method &apos;abstract void log(org.slf4j.Marker, java.lang.String, int, java.lang.String, java.lang.Throwable)&apos; of interface org.slf4j.spi.LocationAwareLogger.
       at org.apache.commons.logging.impl.SLF4JLocationAwareLog.info(SLF4JLocationAwareLog.java:159)
       at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:187)
       at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:47)
       at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:4643)
       at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5109)
       at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)
       at org.apache.catalina.manager.ManagerServlet.start(ManagerServlet.java:1395)
       at org.apache.catalina.manager.HTMLManagerServlet.start(HTMLManagerServlet.java:698)
       at org.apache.catalina.manager.HTMLManagerServlet.doPost(HTMLManagerServlet.java:223)
       at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
       at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
       at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
</code></pre><h3 id="Reason"><a href="#Reason" class="headerlink" title="Reason"></a>Reason</h3><p>If log4j-over-slf4j.jar and slf4j-log4j12.jar exist on the same classpath, the problem arise.      </p>
<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p><strong>Manual test</strong><br>delete log4j-over-slf4j-1.7.5.jar on WEB-INF/lib folder and restart Tomcat 8.</p>
<p><strong>Remove it from pom.xml</strong> </p>
<p>Find transitive dependency in pom:</p>
<pre><code>mvn dependency:tree
</code></pre><p>The output looks like:</p>
<pre><code>[INFO] +- javax.servlet:servlet-api:jar:2.4:compile
[INFO] +- javax.faces:jsf-api:jar:1.2_04:provided
[INFO] +- javax.faces:jsf-impl:jar:1.2_04:provided
[INFO] +- commons-beanutils:commons-beanutils:jar:1.7.0:compile
[INFO] +- commons-digester:commons-digester:jar:1.8:compile
[INFO] +- commons-logging:commons-logging:jar:1.1.1:compile
[INFO] +- commons-logging:commons-logging-api:jar:1.1:compile
[INFO] +- junit:junit:jar:4.7:test
[INFO] +- log4j:log4j:jar:1.2.15:compile
[INFO] |  +- javax.jms:jms:jar:1.1:compile
[INFO] |  \- com.sun.jmx:jmxri:jar:1.2.1:compile
[INFO] +- taglibs:standard:jar:1.1.2:compile
[INFO] +- org.apache.tiles:tiles-api:jar:2.1.4:compile
[INFO] +- org.apache.tiles:tiles-core:jar:2.1.4:compile
[INFO] +- org.apache.tiles:tiles-jsp:jar:2.1.4:compile
[INFO] |  \- org.apache.tiles:tiles-servlet:jar:2.1.4:compile
[INFO] +- com.sun.jdmk:jmxtools:jar:1.2.1:compile
[INFO] +- org.apache.solr:solr-solrj:jar:3.6.2:compile
[INFO] |  +- commons-httpclient:commons-httpclient:jar:3.1:compile
[INFO] |  \- org.codehaus.woodstox:wstx-asl:jar:3.2.7:runtime
[INFO] +- org.slf4j:slf4j-api:jar:1.5.11:compile
[INFO] +- org.slf4j:slf4j-log4j12:jar:1.5.11:compile
[INFO] +- org.slf4j:jcl-over-slf4j:jar:1.5.11:compile
[INFO] +- javax.servlet:jstl:jar:1.2:compile
[INFO] +- org.jvnet.ws.wadl:wadl-core:jar:1.0-SNAPSHOT-NT:compile
[INFO] +- javax.xml.bind:jaxb-api:jar:2.3.1:compile
[INFO] |  \- javax.activation:javax.activation-api:jar:1.2.0:compile
[INFO] +- javax.activation:activation:jar:1.1:compile
[INFO] +- org.glassfish.jaxb:jaxb-runtime:jar:2.3.1:compile
[INFO] |  +- org.glassfish.jaxb:txw2:jar:2.3.1:compile
[INFO] |  +- com.sun.istack:istack-commons-runtime:jar:3.0.7:compile
[INFO] |  +- org.jvnet.staxex:stax-ex:jar:1.8:compile
[INFO] |  \- com.sun.xml.fastinfoset:FastInfoset:jar:1.2.15:compile
[INFO] +- javax.ws.rs:jsr311-api:jar:1.1.1:compile
[INFO] +- com.sun.jersey:jersey-core:jar:1.3:compile
[INFO] +- com.sun.jersey:jersey-client:jar:1.3:compile
[INFO] +- com.sun.jersey.contribs:jersey-spring:jar:1.3:compile
[INFO] +- xalan:xalan:jar:2.7.1:compile
[INFO] |  \- xalan:serializer:jar:2.7.1:compile
[INFO] +- com.sun.jersey:jersey-server:jar:1.3:compile
[INFO] |  \- asm:asm:jar:3.1:compile
[INFO] +- org.springframework:spring-mock:jar:2.0.8:test
[INFO] +- org.springframework:spring-test:jar:3.0.5.RELEASE:test
[INFO] +- org.springframework:spring-web:jar:3.0.5.RELEASE:compile
[INFO] |  \- aopalliance:aopalliance:jar:1.0:compile
[INFO] +- org.springframework:spring-webmvc:jar:3.0.5.RELEASE:compile
[INFO] |  +- org.springframework:spring-asm:jar:3.0.5.RELEASE:compile
[INFO] |  \- org.springframework:spring-context-support:jar:3.0.5.RELEASE:compile
[INFO] +- org.springframework:spring-beans:jar:3.0.5.RELEASE:compile
[INFO] +- org.springframework:spring-context:jar:3.0.5.RELEASE:compile
[INFO] +- org.springframework:spring-core:jar:3.0.5.RELEASE:compile
[INFO] +- org.springframework:spring-expression:jar:3.0.5.RELEASE:compile
[INFO] +- org.springframework.security:spring-security-web:jar:3.0.5.RELEASE:compile
[INFO] +- org.springframework.security:spring-security-config:jar:3.0.5.RELEASE:compile
[INFO] +- org.springframework.security:spring-security-taglibs:jar:3.0.5.RELEASE:compile
[INFO] |  \- org.springframework.security:spring-security-acl:jar:3.0.5.RELEASE:compile
[INFO] |     \- org.springframework:spring-jdbc:jar:3.0.3.RELEASE:compile
[INFO] +- org.springframework:spring-aop:jar:3.0.5.RELEASE:compile
[INFO] +- cglib:cglib:jar:2.2:compile
[INFO] +- org.aspectj:aspectjweaver:jar:1.6.11:compile
[INFO] +- com.yourmediashelf.fedora.client:fedora-client-core:jar:0.8s:compile
[INFO] |  +- com.sun.jersey.contribs:jersey-multipart:jar:1.17.1:compile
[INFO] |  |  \- org.jvnet:mimepull:jar:1.6:compile
[INFO] |  +- com.hp.hpl.jena:jena:jar:2.6.4:compile
[INFO] |  |  +- com.hp.hpl.jena:iri:jar:0.8:compile
[INFO] |  |  \- com.ibm.icu:icu4j:jar:3.4.4:compile
[INFO] |  +- org.apache.santuario:xmlsec:jar:1.5.4:compile
[INFO] |  +- org.slf4j:log4j-over-slf4j:jar:1.7.5:runtime
[INFO] |  \- xerces:xercesImpl:jar:2.11.0:compile
[INFO] +- org.openrdf:openrdf-sesame:jar:onejar:2.3.2:compile
[INFO] +- taglibs:string:jar:1.1.0:compile
[INFO] +- org.apache.commons:commons-lang3:jar:3.4:compile
[INFO] +- rome:rome-fetcher:jar:1.0:compile
[INFO] |  +- jdom:jdom:jar:1.0:compile
[INFO] |  \- rome:rome:jar:1.0:compile
[INFO] +- orbeon:xforms-filter:jar:3.9:compile
[INFO] +- com.jspsmart:upload:jar:1.0:compile
[INFO] +- commons-fileupload:commons-fileupload:jar:1.2.2:compile
[INFO] +- commons-io:commons-io:jar:2.0.1:compile
[INFO] +- dom4j:dom4j:jar:1.6.1:compile
[INFO] |  \- xml-apis:xml-apis:jar:1.0.b2:compile
[INFO] +- jaxen:jaxen:jar:1.1.1:compile
[INFO] |  \- xom:xom:jar:1.0:compile
[INFO] |     \- xerces:xmlParserAPIs:jar:2.6.2:compile
[INFO] +- org.apache.commons:commons-compress:jar:1.0:compile
[INFO] +- javax.mail:mail:jar:1.4.5:compile
[INFO] +- org.apache.commons:commons-email:jar:1.2:compile
[INFO] +- org.freemarker:freemarker:jar:2.3.19:compile
[INFO] +- displaytag:displaytag:jar:1.2:compile
[INFO] |  +- commons-collections:commons-collections:jar:3.1:compile
[INFO] |  +- commons-lang:commons-lang:jar:2.3:compile
[INFO] |  \- com.lowagie:itext:jar:1.3:compile
[INFO] +- jcs:jcs:jar:1.3:compile
[INFO] |  +- commons-configuration:commons-configuration:jar:1.4:compile
[INFO] |  |  +- commons-beanutils:commons-beanutils-core:jar:1.7.0:compile
[INFO] |  |  \- commons-jxpath:commons-jxpath:jar:1.2:compile
[INFO] |  |     \- ant:ant-optional:jar:1.5.1:compile
[INFO] |  +- commons-dbcp:commons-dbcp:jar:1.2.2:compile
[INFO] |  +- commons-pool:commons-pool:jar:1.3:compile
[INFO] |  +- concurrent:concurrent:jar:1.0:compile
[INFO] |  +- mysql:mysql-connector-java:jar:3.0.10:compile
[INFO] |  |  +- javax.sql:jdbc-stdext:jar:2.0:compile
[INFO] |  |  \- javax.transaction:jta:jar:1.0.1B:compile
[INFO] |  +- hsqldb:hsqldb:jar:1.7.3.3:compile
[INFO] |  +- tomcat:tomcat-util:jar:3.2.1:compile
[INFO] |  +- velocity:velocity:jar:1.5:compile
[INFO] |  |  \- oro:oro:jar:2.0.8:compile
[INFO] |  +- xmlrpc:xmlrpc:jar:2.0:compile
[INFO] |  \- berkeleydb:berkeleydb:jar:1.5.1:compile
[INFO] +- net.sf.ehcache:ehcache:jar:2.4.2:compile
[INFO] |  +- net.sf.ehcache:ehcache-core:jar:2.4.2:compile
[INFO] |  \- net.sf.ehcache:ehcache-terracotta:jar:2.4.2:compile
[INFO] +- org.codehaus.jackson:jackson-mapper-lgpl:jar:1.5.6:compile
[INFO] |  \- org.codehaus.jackson:jackson-core-lgpl:jar:1.5.6:compile
[INFO] +- org.apache.httpcomponents:httpclient:jar:4.3.6:compile
[INFO] |  \- commons-codec:commons-codec:jar:1.6:compile
[INFO] +- org.apache.httpcomponents:httpcore:jar:4.3.3:compile
[INFO] +- eu.medsea.mimeutil:mime-util:jar:2.1.3:compile
[INFO] +- joda-time:joda-time:jar:1.6.1:compile
[INFO] +- org.apache.oltu.oauth2:org.apache.oltu.oauth2.client:jar:1.0.1-SNAPSHOT:compile
[INFO] +- org.apache.oltu.oauth2:org.apache.oltu.oauth2.common:jar:1.0.1-SNAPSHOT:compile
[INFO] +- org.json:json:jar:20140107:compile
[INFO] +- org.springframework.security.oauth:spring-security-oauth2:jar:1.0.5.RELEASE:compile
[INFO] |  \- org.codehaus.jackson:jackson-mapper-asl:jar:1.9.2:compile
[INFO] |     \- org.codehaus.jackson:jackson-core-asl:jar:1.9.2:compile
[INFO] \- org.springframework.security:spring-security-core:jar:3.0.5.RELEASE:compile
[INFO]    +- org.springframework:spring-tx:jar:3.0.3.RELEASE:compile
[INFO]    \- org.aspectj:aspectjrt:jar:1.6.8:compile        
</code></pre><p>Do a text search of ‘log4j-over-slf4j’ on the above result, and it shows that the com.yourmediashelf.fedora.client:fedora-client-core:jar has a transitive dependency on log4j-over-slf4j. </p>
<p>In the pom.xml, change:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.yourmediashelf.fedora.client&lt;/groupId&gt;
    &lt;artifactId&gt;fedora-client-core&lt;/artifactId&gt;
    &lt;version&gt;0.8s&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>to:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.yourmediashelf.fedora.client&lt;/groupId&gt;
    &lt;artifactId&gt;fedora-client-core&lt;/artifactId&gt;
    &lt;version&gt;0.8s&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;artifactId&gt;log4j-over-slf4j&lt;/artifactId&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
</code></pre><h2 id="JSTL-problem"><a href="#JSTL-problem" class="headerlink" title="JSTL problem"></a>JSTL problem</h2><p>While loading details page, an error message is showing in the Tomcat log:</p>
<pre><code>[Fatal Error] jstl::1:1: Content is not allowed in prolog.
</code></pre><h3 id="Reason-amp-fix"><a href="#Reason-amp-fix" class="headerlink" title="Reason &amp; fix"></a>Reason &amp; fix</h3><p>The feedbackXML has been’t generated properly if there is no FEEDBACK data stream. In AbstractResourceController.java, line 669:</p>
<pre><code>try{
    XXXXXXX
}catch(Exception e) {
    XXXXXXX
}finally {
&gt;&gt;&gt;&gt;    if(feedbackiris!=null)
        XXXXXX
    else
        XXXXXX
}
</code></pre><p>It should be changed to:</p>
<pre><code>if(feedbackiris!=null &amp;&amp; feedbackiris.startsWith(&quot;&lt;?xml version=&quot;))             
</code></pre><h2 id="Detail-page-problem"><a href="#Detail-page-problem" class="headerlink" title="Detail page problem"></a>Detail page problem</h2><h3 id="Error-message"><a href="#Error-message" class="headerlink" title="Error message"></a>Error message</h3><pre><code>06-Jan-2020 11:42:08.726 SEVERE [http-nio-8080-exec-1] com.sun.xml.bind.v2.util.XmlFactory.createParserFactory null
 org.xml.sax.SAXNotRecognizedException: http://javax.xml.XMLConstants/feature/secure-processing
        at org.apache.xerces.parsers.AbstractSAXParser.setFeature(Unknown Source)
        at org.apache.xerces.jaxp.SAXParserImpl.setFeatures(Unknown Source)
        at org.apache.xerces.jaxp.SAXParserImpl.&lt;init&gt;(Unknown Source)
        at org.apache.xerces.jaxp.SAXParserFactoryImpl.newSAXParserImpl(Unknown Source)
        at org.apache.xerces.jaxp.SAXParserFactoryImpl.setFeature(Unknown Source)
        at com.sun.xml.bind.v2.util.XmlFactory.createParserFactory(XmlFactory.java:136)
        at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.getXMLReader(UnmarshallerImpl.java:154)
        at javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:170)
        at javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:219)
        at com.yourmediashelf.fedora.client.response.FedoraResponseImpl.unmarshallResponse(FedoraResponseImpl.java:133)
        at com.yourmediashelf.fedora.client.response.ObjectDatastreamsResponse.getObjectDatastreams(ObjectDatastreamsRespon
se.java:74)
        at com.yourmediashelf.fedora.client.response.ListDatastreamsResponse.getDatastreams(ListDatastreamsResponse.java:52
)
        at uk.ac.york.dlib.yodling.service.repository.FedoraRepositoryService.getAssets(FedoraRepositoryService.java:565)
        at uk.ac.york.dlib.yodling.web.AbstractResourceController.detail(AbstractResourceController.java:676)
</code></pre><h3 id="Reason-amp-solution"><a href="#Reason-amp-solution" class="headerlink" title="Reason &amp; solution"></a>Reason &amp; solution</h3><p>The problem is caused by Xerces impl, remove xercesImpl-2.4.0.jar will fix this problem.</p>
<p>To remove the dependency from pom.xml, run</p>
<pre><code>mvn dependency:tree
</code></pre><p>And found it was Rome causing the problem:</p>
<pre><code>[INFO] +- rome:rome-fetcher:jar:1.0:compile
[INFO] |  +- jdom:jdom:jar:1.0:compile
[INFO] |  +- xerces:xercesImpl:jar:2.4.0:compile
[INFO] |  \- rome:rome:jar:1.0:compile    
</code></pre><p>Edit pom.xml:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;rome&lt;/groupId&gt;
    &lt;artifactId&gt;rome-fetcher&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
            &lt;groupId&gt;xerces&lt;/groupId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;jaxen&lt;/groupId&gt;
    &lt;artifactId&gt;jaxen&lt;/artifactId&gt;
    &lt;version&gt;1.1.1&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
            &lt;groupId&gt;xerces&lt;/groupId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;jcs&lt;/groupId&gt;
    &lt;artifactId&gt;jcs&lt;/artifactId&gt;
    &lt;version&gt;1.3&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
            &lt;groupId&gt;xerces&lt;/groupId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;    
</code></pre><p>Rebuild &amp; redeploy will fix this problem.                        </p>
<h2 id="IP-restrictions"><a href="#IP-restrictions" class="headerlink" title="IP restrictions"></a>IP restrictions</h2><p>Edit /etc/apache2/sites-enabled/default-ssl.conf, add the following:</p>
<pre><code>&lt;Location /solr&gt;
  Allow from TEST_SERVER_IP                     
  ...
&lt;/Location&gt;  

&lt;Location /fedora/risearch&gt;  
  Allow from TEST_SERVER_IP                     
  ...
&lt;/Location&gt;

&lt;Directory &quot;/usr/digilib-webdocs/digilibImages&quot;&gt;
  Allow from dlibjavatest0.york.ac.uk
  ...
&lt;/Directory&gt;
</code></pre><p>Restart Apache2</p>
<pre><code>service apache2 restart
</code></pre><h2 id="Workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h2><p>As Fedora/Solr server is separated from the front end, there are some work to do to make the workflow working in the new infrastructure.</p>
<h3 id="Paths"><a href="#Paths" class="headerlink" title="Paths"></a>Paths</h3><p><strong>Where the uploaded files are stored?</strong><br>configured in yodl.properties: iris.imageRootFolder</p>
<p>So, on the new Java VM,<br>    sudo mkdir /usr/xxxxxxx-webdocs<br>    sudo chown xxxx:xxxx /usr/xxxxxxx-webdocs<br>    mount -v -o vers=3,sec=sys,tcp rdfs:/vol/yodl2/xxxx-xxxx/test-webdocs /usr/xxxxxxx-webdocs</p>
<p><strong>DO NOT use the default mount parameters!</strong> The following won’t work!</p>
<pre><code>mount rdfs:/vol/xxxx/xxxx-xxxx/test-webdocs /usr/xxxxxxx-webdocs
</code></pre><h3 id="File-upload-submission-handling"><a href="#File-upload-submission-handling" class="headerlink" title="File upload/submission handling"></a>File upload/submission handling</h3><p><strong>WorkflowController</strong><br>File upload handler: WorkflowController.fileUpload</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/iris-migration/" data-id="ck3ekt7s40000c2054mykml83" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fedora/">Fedora</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Solr/">Solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react-char-js" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/react-char-js/" class="article-date">
  <time datetime="2020-01-21T11:20:34.982Z" itemprop="datePublished">2020-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/reactjs/">reactjs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/react-char-js/">Use ReactJS with Chart.js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="HTML-page"><a href="#HTML-page" class="headerlink" title="HTML page"></a>HTML page</h2><pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Downloader Statistics&lt;/title&gt;
    &lt;script src=&quot;https://unpkg.com/react@16/umd/react.development.js&quot; crossorigin&gt;&lt;/script&gt;
    &lt;script src=&quot;https://unpkg.com/react-dom@16/umd/react-dom.development.js&quot; crossorigin&gt;&lt;/script&gt;
    &lt;script src=&quot;https://unpkg.com/babel-standalone@6/babel.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js&quot;&gt;&lt;/script&gt;

    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;iris_statistics.css&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id = &quot;iris_downloader_statistics&quot;&gt;

    &lt;/div&gt;

    &lt;script type=&quot;text/jsx&quot; src=&quot;iris_statistics.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h2><pre><code>&apos;use strict&apos;;
const e = React.createElement;

class LineGraph extends React.Component {
    chartRef = React.createRef();

    componentDidMount() {
        const myChartRef = this.chartRef.current.getContext(&quot;2d&quot;);

        new Chart(myChartRef, {
            type: &quot;line&quot;,
            data: {
                labels: [&quot;Jan&quot;, &quot;Feb&quot;, &quot;March&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;],
                datasets: [
                    {
                        label: &quot;Downloads&quot;,
                        data: [651, 1034, 843, 877, 649, 661, 490, 332, 514, 914, 903, 602],
                    }
                ]
            },
            options: {
                //Customize chart options
            }
        });
    }
    render() {
        return (
            &lt;div&gt;
              &lt;canvas
                id=&quot;myChart&quot;
                ref={this.chartRef}
              /&gt;
            &lt;/div&gt;
        )
    }
}


const domContainer = document.querySelector(&apos;#iris_downloader_statistics&apos;);
ReactDOM.render(e(LineGraph), domContainer);
</code></pre><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><pre><code>#title {
  text-align: center;
  font-family: arial, sans-serif;
}

#downloads {
  text-align: center;
  font-family: &quot;Trebuchet MS&quot;, Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  border: 3px solid #ddd;
  width: 100%;
}

#downloads td, #downloads th {
  border: 1px solid #ddd;
  padding: 8px;
}

#downloads tr:nth-child(even){background-color: #f2f2f2;}

#downloads tr:hover {background-color: #ddd;}

#downloads th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: center;
  background-color: #4CAF50;
  color: white;
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/react-char-js/" data-id="ck92o0lyo0000ky05vu69mnp8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Chart-js/">Chart.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactJS/">ReactJS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-aws-java-sdk-s3-dynamodb" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/aws-java-sdk-s3-dynamodb/" class="article-date">
  <time datetime="2020-01-17T15:20:55.733Z" itemprop="datePublished">2020-01-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/AWS/">AWS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/aws-java-sdk-s3-dynamodb/">Using AWS Java SDK for S3 and DynamoDB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Below is just my notes following this official AWS Java SDK tutorial.</p>
<h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.yf.demos&lt;/groupId&gt;
    &lt;artifactId&gt;aws-java-demo&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;name&gt;aws-java-demo&lt;/name&gt;
    &lt;url&gt;http://aws.amazon.com/sdkforjava&lt;/url&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
                &lt;artifactId&gt;aws-java-sdk-bom&lt;/artifactId&gt;
                &lt;version&gt;1.11.327&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
            &lt;artifactId&gt;aws-java-sdk&lt;/artifactId&gt;
            &lt;version&gt;1.11.708&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
            &lt;artifactId&gt;aws-java-sdk-dynamodb&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;jakarta.xml.bind&lt;/groupId&gt;
            &lt;artifactId&gt;jakarta.xml.bind-api&lt;/artifactId&gt;
            &lt;version&gt;2.3.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;
            &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;
            &lt;version&gt;2.3.2&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;resources&gt;
            &lt;resource&gt;
                &lt;directory&gt;${env.HOME}/.aws/&lt;/directory&gt;
            &lt;/resource&gt;
        &lt;/resources&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.3&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.2.1&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;java&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.amazonaws.samples.DynamoDBScanTest&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre><h2 id="Access-S3"><a href="#Access-S3" class="headerlink" title="Access S3"></a>Access S3</h2><pre><code>/*
 * Copyright 2010-2013 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;).
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *
 *  http://aws.amazon.com/apache2.0
 *
 * or in the &quot;license&quot; file accompanying this file. This file is distributed
 * on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
package com.amazonaws.samples;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.Writer;
import java.util.UUID;

import com.amazonaws.AmazonClientException;
import com.amazonaws.AmazonServiceException;
import com.amazonaws.regions.Region;
import com.amazonaws.regions.Regions;
import com.amazonaws.services.s3.AmazonS3;
import com.amazonaws.services.s3.AmazonS3Client;
import com.amazonaws.services.s3.model.Bucket;
import com.amazonaws.services.s3.model.GetObjectRequest;
import com.amazonaws.services.s3.model.ListObjectsRequest;
import com.amazonaws.services.s3.model.ObjectListing;
import com.amazonaws.services.s3.model.PutObjectRequest;
import com.amazonaws.services.s3.model.S3Object;
import com.amazonaws.services.s3.model.S3ObjectSummary;

public class S3Sample {

    public static void main(String[] args) throws IOException {
        AmazonS3 s3 = new AmazonS3Client();
        Region euWest1 = Region.getRegion(Regions.EU_WEST_1);
        s3.setRegion(euWest1);

        String bucketName = &quot;my-first-s3-bucket-&quot; + UUID.randomUUID();
        String key = &quot;MyObjectKey&quot;;

        System.out.println(&quot;===========================================&quot;);
        System.out.println(&quot;Getting Started with Amazon S3&quot;);
        System.out.println(&quot;===========================================\n&quot;);

        try {
/*
            System.out.println(&quot;Creating bucket &quot; + bucketName + &quot;\n&quot;);
            s3.createBucket(bucketName);
*/

            System.out.println(&quot;Listing buckets&quot;);
            for (Bucket bucket : s3.listBuckets()) {
                System.out.println(&quot; - &quot; + bucket.getName());
            }
            System.out.println();

/*
            System.out.println(&quot;Uploading a new object to S3 from a file\n&quot;);
            s3.putObject(new PutObjectRequest(bucketName, key, createSampleFile()));
*/

/*
            System.out.println(&quot;Downloading an object&quot;);
            S3Object object = s3.getObject(new GetObjectRequest(bucketName, key));
            System.out.println(&quot;Content-Type: &quot;  + object.getObjectMetadata().getContentType());
            displayTextInputStream(object.getObjectContent());
*/
/*
            System.out.println(&quot;Listing objects&quot;);
            ObjectListing objectListing = s3.listObjects(new ListObjectsRequest()
                    .withBucketName(bucketName)
                    .withPrefix(&quot;My&quot;));
            for (S3ObjectSummary objectSummary : objectListing.getObjectSummaries()) {
                System.out.println(&quot; - &quot; + objectSummary.getKey() + &quot;  &quot; +
                        &quot;(size = &quot; + objectSummary.getSize() + &quot;)&quot;);
            }
            System.out.println();
*/

/*
            System.out.println(&quot;Deleting an object\n&quot;);
            s3.deleteObject(bucketName, key);
*/

/*
            System.out.println(&quot;Deleting bucket &quot; + bucketName + &quot;\n&quot;);
            s3.deleteBucket(bucketName);
 */
        } catch (AmazonServiceException ase) {
            System.out.println(&quot;Caught an AmazonServiceException, which means your request made it &quot;
                    + &quot;to Amazon S3, but was rejected with an error response for some reason.&quot;);
            System.out.println(&quot;Error Message:    &quot; + ase.getMessage());
            System.out.println(&quot;HTTP Status Code: &quot; + ase.getStatusCode());
            System.out.println(&quot;AWS Error Code:   &quot; + ase.getErrorCode());
            System.out.println(&quot;Error Type:       &quot; + ase.getErrorType());
            System.out.println(&quot;Request ID:       &quot; + ase.getRequestId());
        } catch (AmazonClientException ace) {
            System.out.println(&quot;Caught an AmazonClientException, which means the client encountered &quot;
                    + &quot;a serious internal problem while trying to communicate with S3, &quot;
                    + &quot;such as not being able to access the network.&quot;);
            System.out.println(&quot;Error Message: &quot; + ace.getMessage());
        }
    }

    private static File createSampleFile() throws IOException {
        File file = File.createTempFile(&quot;aws-java-sdk-&quot;, &quot;.txt&quot;);
        file.deleteOnExit();

        Writer writer = new OutputStreamWriter(new FileOutputStream(file));
        writer.write(&quot;abcdefghijklmnopqrstuvwxyz\n&quot;);
        writer.write(&quot;01234567890112345678901234\n&quot;);
        writer.write(&quot;!@#$%^&amp;*()-=[]{};&apos;:&apos;,.&lt;&gt;/?\n&quot;);
        writer.write(&quot;01234567890112345678901234\n&quot;);
        writer.write(&quot;abcdefghijklmnopqrstuvwxyz\n&quot;);
        writer.close();

        return file;
    }

    private static void displayTextInputStream(InputStream input) throws IOException {
        BufferedReader reader = new BufferedReader(new InputStreamReader(input));
        while (true) {
            String line = reader.readLine();
            if (line == null) break;

            System.out.println(&quot;    &quot; + line);
        }
        System.out.println();
    }

}
</code></pre><h2 id="Query-DynamoDB"><a href="#Query-DynamoDB" class="headerlink" title="Query DynamoDB"></a>Query DynamoDB</h2><pre><code>package com.amazonaws.samples;

import com.amazonaws.services.dynamodbv2.AmazonDynamoDB;
import com.amazonaws.services.dynamodbv2.AmazonDynamoDBClientBuilder;
import com.amazonaws.services.dynamodbv2.model.*;
import com.amazonaws.services.dynamodbv2.model.AmazonDynamoDBException;
import com.amazonaws.AmazonServiceException;

import com.amazonaws.regions.Region;
import com.amazonaws.regions.Regions;

import java.util.Map;
import java.util.HashMap;
import java.io.IOException;

public class DynamoDBQueryTest {
    public static &lt;DynamoDbClient, ScanIterable, ScanResponse&gt; void main(String[] args) throws IOException {
        String table_name = &quot;XXXXXXXX&quot;;
        String partition_key_name = &quot;date&quot;;
        String partition_key_val = &quot;2013-03-08&quot;;
        String partition_alias = &quot;#a&quot;;

        System.out.format(&quot;Querying %s&quot;, table_name);
        System.out.println(&quot;&quot;);

        final AmazonDynamoDB ddb = AmazonDynamoDBClientBuilder.defaultClient();

        //set up an alias for the partition key name in case it&apos;s a reserved word
        HashMap&lt;String,String&gt; attrNameAlias =
                new HashMap&lt;String,String&gt;();
        attrNameAlias.put(partition_alias, partition_key_name);

        //set up mapping of the partition name with the value
        HashMap&lt;String, AttributeValue&gt; attrValues =
                new HashMap&lt;String,AttributeValue&gt;();
        attrValues.put(&quot;:&quot;+partition_key_name, new AttributeValue().withS(partition_key_val));

        QueryRequest queryReq = new QueryRequest()
                .withTableName(table_name)
                .withKeyConditionExpression(partition_alias + &quot; = :&quot; + partition_key_name)
                .withExpressionAttributeNames(attrNameAlias)
                .withExpressionAttributeValues(attrValues);

        try {
            QueryResult response = ddb.query(queryReq);
            //System.out.println(response.getCount());
            System.out.println();
            System.out.println(response);
        } catch (AmazonDynamoDBException e) {
            System.err.println(e.getErrorMessage());
            System.exit(1);
        }
    }
}
</code></pre><h2 id="Scan-a-DynamoDB"><a href="#Scan-a-DynamoDB" class="headerlink" title="Scan a DynamoDB"></a>Scan a DynamoDB</h2><pre><code>package com.amazonaws.samples;

import java.util.Iterator;

import com.amazonaws.client.builder.AwsClientBuilder;
import com.amazonaws.services.dynamodbv2.AmazonDynamoDB;
import com.amazonaws.services.dynamodbv2.AmazonDynamoDBClientBuilder;
import com.amazonaws.services.dynamodbv2.document.DynamoDB;
import com.amazonaws.services.dynamodbv2.document.Item;
import com.amazonaws.services.dynamodbv2.document.ItemCollection;
import com.amazonaws.services.dynamodbv2.document.ScanOutcome;
import com.amazonaws.services.dynamodbv2.document.Table;
import com.amazonaws.services.dynamodbv2.document.spec.ScanSpec;
import com.amazonaws.services.dynamodbv2.document.utils.NameMap;
import com.amazonaws.services.dynamodbv2.document.utils.ValueMap;

public class DynamoDBScanTest {
    public static void main(String[] args) throws Exception {
        String table_name = &quot;XXXXXXXX&quot;;
        String partition_key_name = &quot;date&quot;;
        String partition_key_val = &quot;2013-03-08&quot;;
        String partition_alias = &quot;#a&quot;;

        AmazonDynamoDB client = AmazonDynamoDBClientBuilder.standard()
                .build();

        DynamoDB dynamoDB = new DynamoDB(client);

        Table table = dynamoDB.getTable(table_name);

        // Scan between 2 dates
        /*
        ScanSpec scanSpec = new ScanSpec().withProjectionExpression(&quot;#date, pid, downloads, title&quot;)
                .withFilterExpression(&quot;#date between :start_date and :end_date&quot;).withNameMap(new NameMap().with(&quot;#date&quot;, &quot;date&quot;))
                .withValueMap(new ValueMap().withString(&quot;:start_date&quot;, &quot;2018-08-01&quot;).withString(&quot;:end_date&quot;, &quot;2018-08-31&quot;));
         */

        // Scan a month
        ScanSpec scanSpec = new ScanSpec().withProjectionExpression(&quot;#date, pid, downloads, title&quot;)
                .withFilterExpression(&quot;contains(#date, :month)&quot;)
                .withNameMap(new NameMap().with(&quot;#date&quot;, &quot;date&quot;))
                .withValueMap(new ValueMap().withString(&quot;:month&quot;, &quot;2018-08&quot;));

        try {
            ItemCollection&lt;ScanOutcome&gt; items = table.scan(scanSpec);
            Iterator&lt;Item&gt; iter = items.iterator();
            while (iter.hasNext()) {
                Item item = iter.next();
                System.out.println(item.toString());
            }
        }
        catch (Exception e) {
            System.err.println(&quot;Unable to scan the table:&quot;);
            System.err.println(e.getMessage());
        }

    }
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/aws-java-sdk-s3-dynamodb/" data-id="ck92o0m3o000jky05c8jee76b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DynamoDB/">DynamoDB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws/">aws</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/s3/">s3</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iris-new-field" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/iris-new-field/" class="article-date">
  <time datetime="2020-01-14T11:20:45.854Z" itemprop="datePublished">2020-01-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/iris-new-field/">How to add a new field in IRIS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="XML-Schema"><a href="#XML-Schema" class="headerlink" title="XML Schema"></a>XML Schema</h2><p>Use ‘reliability’ as an example.</p>
<p>First, add reliability under _instrumentType: </p>
<pre><code>&lt;xs:complexType name=&quot;_instrumentType&quot;&gt;
  &lt;xs:choice minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;&gt;
    ...
    &lt;xs:element ref=&quot;reliability&quot;/&gt;
    ...
  &lt;/xs:choice&gt;
&lt;/xs:complexType&gt;
</code></pre><p>Declare reliability element:</p>
<pre><code>&lt;xs:element name=&quot;reliability&quot;&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base=&quot;xs:string&quot;&gt;
          &lt;xs:attribute name=&quot;vocab&quot; type=&quot;xs:anyURI&quot;/&gt;
          &lt;xs:attribute name=&quot;newValue&quot; type=&quot;xs:string&quot;/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;      
</code></pre><h2 id="Data-dictionary"><a href="#Data-dictionary" class="headerlink" title="Data dictionary"></a>Data dictionary</h2><p>Edit commons.xml, and add:</p>
<pre><code>&lt;Reliabilities name=&quot;Reliability&quot; vocab=&quot;http://dlib.york.ac.uk/ontologies/iris/reliability&quot;&gt;
    &lt;Reliability vocab=&quot;http://dlib.york.ac.uk/ontologies/iris/reliability#&quot; value=&quot;001&quot; label=&quot;Kappa&quot;/&gt;
    &lt;Reliability vocab=&quot;http://dlib.york.ac.uk/ontologies/iris/reliability#&quot; value=&quot;999&quot; label=&quot;Other&quot;/&gt;
&lt;/Reliabilities&gt;
</code></pre><p>Add preReliabilities.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;reliabilities&gt;
&lt;/reliabilities&gt;
</code></pre><h2 id="Default-xml-file"><a href="#Default-xml-file" class="headerlink" title="Default xml file"></a>Default xml file</h2><p>Edit IRIS.xml and add placeholder:</p>
<pre><code>&lt;iris:reliability newValue=&quot;&quot;/&gt;
</code></pre><h2 id="Xforms"><a href="#Xforms" class="headerlink" title="Xforms"></a>Xforms</h2><p>To enable show/hide button/link, add:</p>
<pre><code>&lt;xforms:instance id=&quot;xform-tree-switches&quot;&gt;
    &lt;irisform:switches&gt;
        ......
        &lt;irisform:reliability open=&quot;true&quot;/&gt;
    &lt;/irisform:switches&gt;    
&lt;/xforms:instance&gt;
</code></pre><p>Add related xform sections for reliability.    </p>
<h2 id="gsearch-XSLT"><a href="#gsearch-XSLT" class="headerlink" title="gsearch XSLT"></a>gsearch XSLT</h2><p>Edit foxmlToSolrGenerated.xslt</p>
<h2 id="Solr"><a href="#Solr" class="headerlink" title="Solr"></a>Solr</h2><p>Edit schema.xml and add:</p>
<pre><code>&lt;field name=&quot;iris.instrument.reliability&quot;  type=&quot;string&quot;  indexed=&quot;true&quot;  stored=&quot;true&quot; multiValued=&quot;true&quot;/&gt;
...
&lt;field name=&quot;iris2.instrument.reliability&quot;  type=&quot;string&quot;  indexed=&quot;true&quot;  stored=&quot;true&quot; multiValued=&quot;true&quot;/&gt;
...
&lt;copyField source=&quot;iris.instrument.reliability&quot; dest=&quot;iris2.instrument.reliability&quot;/&gt; 
</code></pre><p>Edit solrconfig.xml and add:</p>
<pre><code>iris2.instrument.reliability^2
</code></pre><h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/iris-new-field/" data-id="ck56tlql90000aw059zxou1wg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Solr/">Solr</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xforms/">xforms</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react-iris-statistics" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/react-iris-statistics/" class="article-date">
  <time datetime="2020-01-10T18:48:31.143Z" itemprop="datePublished">2020-01-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/reactjs/">reactjs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/react-iris-statistics/">Use ReactJS to build IRIS statistics app</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Setup-project"><a href="#Setup-project" class="headerlink" title="Setup project"></a>Setup project</h2><pre><code>npx create-react-app iris-statistics
cd iris-statistics
yarn start
</code></pre><p>You will see the UI:</p>
<pre><code>https://snipboard.io/FawR2z.jpg
</code></pre><h2 id="Component"><a href="#Component" class="headerlink" title="Component"></a>Component</h2><p>Add LanguageList.js:</p>
<pre><code>import React from &apos;react&apos;;

class LanguageList extends React.Component {
    render() {
        return (
            &lt;div className=&quot;language-list&quot;&gt;
                &lt;h1&gt;My favorite language list&lt;/h1&gt;
                &lt;ul&gt;
                    &lt;li&gt;Python&lt;/li&gt;
                    &lt;li&gt;NodeJS&lt;/li&gt;
                    &lt;li&gt;Java&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        );
    }
}

export default LanguageList;
</code></pre><p>Use it in App.js:</p>
<pre><code>import LanguageList from &apos;./LanguageList&apos;;

function App() {
  return (
    &lt;div className=&quot;App&quot;&gt;
      &lt;header className=&quot;App-header&quot;&gt;
        &lt;p&gt;
          &lt;LanguageList /&gt;
        &lt;/p&gt;
      &lt;/header&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>You will see: </p>
<p><img src="https://snipboard.io/lLJUWH.jpg" alt=""></p>
<h2 id="Board-Game-UI"><a href="#Board-Game-UI" class="headerlink" title="Board Game UI"></a>Board Game UI</h2><p>Square.js:</p>
<pre><code>import React from &apos;react&apos;;

class Square extends React.Component {
    render() {
        return (
            &lt;button className=&quot;square&quot;&gt;
                {/* TODO */}
            &lt;/button&gt;
        );
    }
}

export default Square;
</code></pre><p>Board.js:</p>
<pre><code>import React from &apos;react&apos;;

import Square from &apos;./Square&apos;;

class Board extends React.Component {
    renderSquare(i) {
        return &lt;Square /&gt;;
    }

    render() {
        const status = &apos;Next player: X&apos;;

        return (
            &lt;div&gt;
                &lt;div className=&quot;status&quot;&gt;{status}&lt;/div&gt;
                &lt;div className=&quot;board-row&quot;&gt;
                    {this.renderSquare(0)}
                    {this.renderSquare(1)}
                    {this.renderSquare(2)}
                &lt;/div&gt;
                &lt;div className=&quot;board-row&quot;&gt;
                    {this.renderSquare(3)}
                    {this.renderSquare(4)}
                    {this.renderSquare(5)}
                &lt;/div&gt;
                &lt;div className=&quot;board-row&quot;&gt;
                    {this.renderSquare(6)}
                    {this.renderSquare(7)}
                    {this.renderSquare(8)}
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }
}

export default Board;
</code></pre><p>Within App.js:</p>
<pre><code>&lt;div className=&quot;game-board&quot;&gt;
    &lt;Board /&gt;
&lt;/div&gt;        
</code></pre><p>Add CSS in App.css:</p>
<pre><code>body {
  font: 14px &quot;Century Gothic&quot;, Futura, sans-serif;
  margin: 20px;
}

ol, ul {
  padding-left: 30px;
}

.board-row:after {
  clear: both;
  content: &quot;&quot;;
  display: table;
}

.status {
  margin-bottom: 10px;
}

.square {
  background: #fff;
  border: 1px solid #999;
  float: left;
  font-size: 24px;
  font-weight: bold;
  line-height: 34px;
  height: 34px;
  margin-right: -1px;
  margin-top: -1px;
  padding: 0;
  text-align: center;
  width: 34px;
}

.square:focus {
  outline: none;
}

.kbd-navigation .square:focus {
  background: #ddd;
}

.game {
  display: flex;
  flex-direction: row;
}

.game-info {
  margin-left: 20px;
}
</code></pre><h2 id="Pass-a-prop-to-component"><a href="#Pass-a-prop-to-component" class="headerlink" title="Pass a prop to component"></a>Pass a prop to component</h2><p>in Board.js:</p>
<pre><code>renderSquare(i) {
    return &lt;Square value={i}/&gt;;
}
</code></pre><p>Change Square.js:</p>
<pre><code>&lt;button className=&quot;square&quot;&gt;
    {this.props.value}
&lt;/button&gt;            
</code></pre><p>Now you will see:</p>
<p><img src="https://snipboard.io/rDe6Nj.jpg" alt=""></p>
<h2 id="Making-interactive-component"><a href="#Making-interactive-component" class="headerlink" title="Making interactive component"></a>Making interactive component</h2><p>Test onClick event, in Square.js:</p>
<pre><code>&lt;button className=&quot;square&quot; onClick={function() { alert(&apos;click&apos;); }}&gt;
    {this.props.value}
&lt;/button&gt;
</code></pre><p>Or with arrow function:</p>
<pre><code>&lt;button className=&quot;square&quot; onClick={() =&gt; alert(&apos;click&apos;) }&gt;
</code></pre><p>Add constructor to Square:</p>
<pre><code>constructor(props) {
    super(props);
    this.state = {
       value: null,
    };
}
</code></pre><p>and:</p>
<pre><code>&lt;button className=&quot;square&quot; onClick={() =&gt; this.setState({value: &apos;X&apos;}) }&gt;
   {this.state.value}
&lt;/button&gt;    
</code></pre><h2 id="React-Dev-tool-extension"><a href="#React-Dev-tool-extension" class="headerlink" title="React Dev tool extension"></a>React Dev tool extension</h2><p>Install it and it will help you to debug React app</p>
<h2 id="Complete-the-game"><a href="#Complete-the-game" class="headerlink" title="Complete the game"></a>Complete the game</h2><p>To collect data from multiple children, or to have two child components communicate with each other, you need to declare the shared state in their parent component instead. The parent component can pass the state back down to the children by using props; this keeps the child components in sync with each other and with the parent component.</p>
<p>Add a constructor to Board:</p>
<pre><code>constructor(props) {
    super(props);
    this.state = {
      squares: Array(9).fill(null),
    };
}
</code></pre><p>Change renderSquare:</p>
<pre><code>renderSquare(i) {
    return &lt;Square value={this.state.squares[i]} /&gt;;
}    
</code></pre><p>Locate the following string to continue</p>
<p>After these changes, we’re again able to click on the Squares to fill them, the same as we had before. However, now the state is stored in the Board component instead of the individual Square components. When the Board’s state changes, the Square components re-render automatically. Keeping the state of all squares in the Board component will allow it to determine the winner in the future.    </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/react-iris-statistics/" data-id="ck92o0lze0001ky05vjgxhcy4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactJS/">ReactJS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react-graphql-amplify" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/react-graphql-amplify/" class="article-date">
  <time datetime="2019-12-23T10:34:24.507Z" itemprop="datePublished">2019-12-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/AWS/">AWS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/react-graphql-amplify/">React GraphQL and Amplify</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Below is just my notes following this tutorial: <a href="https://read.acloud.guru/build-your-own-multi-user-photo-album-app-with-react-graphql-and-aws-amplify-18d9cfe27f60" target="_blank" rel="noopener">https://read.acloud.guru/build-your-own-multi-user-photo-album-app-with-react-graphql-and-aws-amplify-18d9cfe27f60</a></p>
<h2 id="Create-React-application"><a href="#Create-React-application" class="headerlink" title="Create React application"></a>Create React application</h2><pre><code>npx create-react-app photo-albums
</code></pre><p>Test if it works:</p>
<pre><code>cd photo-albums
npm start
</code></pre><p>Try to access it from <a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a>        </p>
<p>Install semantic-ui-react pacakge to make our UI looking nicer:</p>
<pre><code>npm install --save semantic-ui-react
</code></pre><p>Edit public/index.html and add to head section:</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.3/semantic.min.css&quot;&gt;&lt;/link&gt;
</code></pre><p>Edit App.js with the following content:</p>
<pre><code>import React, { Component } from &apos;react&apos;;
import { Header } from &apos;semantic-ui-react&apos;;

class App extends Component {
  render() {
    return (
        &lt;div&gt;
          &lt;Header as=&apos;h1&apos;&gt;Hello World!&lt;/Header&gt;
        &lt;/div&gt;
    );
  }
}
export default App;
</code></pre><h2 id="Use-amplify-to-add-user-authentication"><a href="#Use-amplify-to-add-user-authentication" class="headerlink" title="Use amplify to add user authentication"></a>Use amplify to add user authentication</h2><h3 id="amplify-installation"><a href="#amplify-installation" class="headerlink" title="amplify installation"></a>amplify installation</h3><p>If amplify is not installed, do following:</p>
<pre><code>npm install -g @aws-amplify/cli
amplify configure
</code></pre><h3 id="Link-project-to-AWS"><a href="#Link-project-to-AWS" class="headerlink" title="Link project to AWS"></a>Link project to AWS</h3><p>In project folder, run </p>
<pre><code>amplify init
</code></pre><p>Then choose the following values:</p>
<p>Choose the type of app that you’re building: javascript</p>
<p>What javascript framework are you using: react</p>
<p>Choose default settings for other questions.</p>
<p>After this command, the following files will be created:</p>
<pre><code>modified:   .gitignore
new file:   amplify/.config/project-config.json
new file:   amplify/backend/backend-config.json
new file:   amplify/team-provider-info.json
</code></pre><h3 id="Add-auth-to-AWS-Cognito-with-amplify"><a href="#Add-auth-to-AWS-Cognito-with-amplify" class="headerlink" title="Add auth to AWS Cognito with amplify"></a>Add auth to AWS Cognito with amplify</h3><p>Run</p>
<pre><code>amplify add auth
</code></pre><p>Use default configuration</p>
<p>Run the following command to push your local backend resources and provision it in the cloud:</p>
<pre><code>amplify push
</code></pre><p>The above command willl update src/aws-exports.js with configuration data. </p>
<p>Till now, you have created a serverless backend for user registration and authorization with Amazon Cognito.</p>
<h3 id="Frontend-for-user-auth-and-authz"><a href="#Frontend-for-user-auth-and-authz" class="headerlink" title="Frontend for user auth and authz"></a>Frontend for user auth and authz</h3><p>Run:</p>
<pre><code>npm install --save aws-amplify aws-amplify-react
</code></pre><p>Edit src/App.js, add following:</p>
<pre><code>import Amplify from &apos;aws-amplify&apos;;
import aws_exports from &apos;./aws-exports&apos;;
import { withAuthenticator } from &apos;aws-amplify-react&apos;;
Amplify.configure(aws_exports);
</code></pre><p>and</p>
<pre><code>export default withAuthenticator(App, {includeGreetings: true});
</code></pre><p>Now check the app in browser, you will see:</p>
<p><img src="https://user-images.githubusercontent.com/437701/71269603-a40a2580-2347-11ea-8004-86447277e4b0.png" alt="amplify with Cognito"></p>
<p>Now the auth / authz is working. If you want to do more customization, check this:</p>
<p><a href="https://aws.github.io/aws-amplify/media/authentication_guide#customization" target="_blank" rel="noopener">https://aws.github.io/aws-amplify/media/authentication_guide#customization</a></p>
<h2 id="Create-a-serverless-GraphQL-API-backend-with-AWS-AppSync"><a href="#Create-a-serverless-GraphQL-API-backend-with-AWS-AppSync" class="headerlink" title="Create a serverless GraphQL API backend with AWS AppSync"></a>Create a serverless GraphQL API backend with AWS AppSync</h2><p><img src="https://user-images.githubusercontent.com/437701/71270123-ba64b100-2348-11ea-9625-ab2132100308.png" alt="AWS AppSync"></p>
<p>Run </p>
<pre><code>amplify add api
</code></pre><p>Answer like below:</p>
<pre><code>? Please select from one of the below mentioned services: GraphQL
? Provide API name: photoalbums
? Choose the default authorization type for the API Amazon Cognito User Pool
? Do you want to configure advanced settings for the GraphQL API No
? Do you have an annotated GraphQL schema? No
? Do you want a guided schema creation? Yes
? What best describes your project: One-to-many relationship (e.g., “Blogs” with “Posts” and “Comments”)
? Do you want to edit the schema now? Yes
? Press enter to continue Selected  editor intellij was not found in your machine. Please manually edit the file created at /xxxx/photo-albums/amplify/backend/api/photoalbums/schema.graphql       
</code></pre><p>Edit file: /amplify/backend/api/photoalbums/schema.graphql with content:</p>
<pre><code>type Album @model {
  id: ID!
  name: String!
  owner: String!
  photos: [Photo] @connection(name: &quot;AlbumPhotos&quot;)
}

type Photo @model {
  id: ID!
  album: Album @connection(name: &quot;AlbumPhotos&quot;)
  bucket: String!
  fullsize: PhotoS3Info!
  thumbnail: PhotoS3Info!
}

type PhotoS3Info {
    key: String!
    width: Int!
    height: Int!
}
</code></pre><p>Press enter to continue</p>
<p>Run</p>
<pre><code>amplify push
</code></pre><h3 id="Test-AppSync-API"><a href="#Test-AppSync-API" class="headerlink" title="Test AppSync API"></a>Test AppSync API</h3><p>Open AppSync web console, then click ‘Login with User Pools’.</p>
<p>In the ClientId field, enter ‘aws_user_pools_web_client_id’ defined in ‘aws-export.js’, then username/password, and click ‘Login’        </p>
<p><img src="https://user-images.githubusercontent.com/437701/71351456-a1881580-256b-11ea-95ce-54e96b22d467.png" alt="image"></p>
<p>Add a new album:</p>
<pre><code>mutation {
    createAlbum(input:{name:&quot;First Album&quot;, owner:&quot;Someone&quot;}) {
        id
        name
    }
}
</code></pre><p>Add second album:</p>
<pre><code>mutation {
    createAlbum(input:{name:&quot;Second Album&quot;, owner:&quot;Someone&quot;}) {
        id
        name
    }
}
</code></pre><p>List albums:</p>
<pre><code>query {
    listAlbums {
        items {
            id
            name
            owner
        }
    }
}
</code></pre><p>In AWS AppSync, Click ‘Schema’, then under ‘Resolvers’, search for ‘mutation’, click ‘AlbumTable’ link next to createAlbum,</p>
<p><img src="https://user-images.githubusercontent.com/437701/71352163-769ec100-256d-11ea-865c-d1c534f3238f.png" alt="image"></p>
<p>On top of the code, add a new line:</p>
<pre><code>$util.qr($context.args.input.put(&quot;owner&quot;, $context.identity.username))
</code></pre><p>Then click ‘Save Resolver’        </p>
<p>Also, since we’re no longer passing a value for owner, edit Schema, and edit createAlbumInput to:</p>
<pre><code>input CreateAlbumInput {
    id: ID
    name: String!
}
</code></pre><p><img src="https://user-images.githubusercontent.com/437701/71352644-be721800-256e-11ea-8001-70885f5599ef.png" alt="image"></p>
<p>Test by creating another Album:</p>
<pre><code>mutation {
    createAlbum(input: {name:&quot;Album with username from context&quot;}) {
        id
        name
        owner
    }
}
</code></pre><p>The album’s owner filed contains the username we logged in with.</p>
<h2 id="Connecting-app-to-GraphQL-API-via-Apollo-client"><a href="#Connecting-app-to-GraphQL-API-via-Apollo-client" class="headerlink" title="Connecting app to GraphQL API via Apollo client"></a>Connecting app to GraphQL API via Apollo client</h2><p>The Amplify CLI has already taken care of making sure that our src/aws-exports.js file contains all of the configuration we’ll need to pass to the Amplify JS library in order to talk to the AppSync API. All we’ll need to do is add some new code to interact with the API.</p>
<p>In the real app, we should create seperate files, but for now, we put everything in a single file:</p>
<p>Edit src/App.js:</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/react-graphql-amplify/" data-id="ck56tlqlg0001aw05bhu1t72n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/amplify/">amplify</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws/">aws</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/graphql/">graphql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-aws-s3-localstack" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/aws-s3-localstack/" class="article-date">
  <time datetime="2019-12-06T16:41:38.997Z" itemprop="datePublished">2019-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/AWS/">AWS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/aws-s3-localstack/">AWS S3 localstack</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Below is just my notes following this tutorial: <a href="https://dev.to/goodidea/how-to-fake-aws-locally-with-localstack-27me" target="_blank" rel="noopener">https://dev.to/goodidea/how-to-fake-aws-locally-with-localstack-27me</a></p>
<h2 id="LocalStack"><a href="#LocalStack" class="headerlink" title="LocalStack"></a>LocalStack</h2><p><a href="https://github.com/localstack/localstack" target="_blank" rel="noopener">Localstack</a> allows you to play AWS services on your PC. Lots of AWS services are supported by localstack.  </p>
<p>The benefits of using localstack:</p>
<ul>
<li>Work offline</li>
<li>You have full control of your own dev environment</li>
<li>You can easily wipe &amp; replace your local buckets</li>
<li>Free!</li>
</ul>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><p>Make sure you have installed the following: </p>
<ul>
<li>Docker</li>
<li>AWS CLI</li>
<li>AWS being configured (if not, run aws configure to create some credentials), actually localstack doesn’t check your credentials, as long as they are not empty!</li>
</ul>
<p>Create a project folder and add some files</p>
<pre><code>mkdir test1
touch index.js docker-compose.yml .env
mkdir .localstack
</code></pre><p>Copy a image, e.g. test.jpg to your project folder.</p>
<p>Run the following commands to init the project and install npm packages:</p>
<pre><code>npm init 
npm install aws-sdk dotenv
</code></pre><p>Edit docker-compose.yml with content:</p>
<pre><code>version: &apos;3.2&apos;
services:
  localstack:
    image: localstack/localstack:latest
    container_name: localstack_demo
    ports:
      - &apos;4563-4599:4563-4599&apos;
      - &apos;8055:8080&apos;
    environment:
      - SERVICES=s3
      - DEBUG=1
      - DATA_DIR=/tmp/localstack/data
    volumes:
      - &apos;./.localstack:/tmp/localstack&apos;
      - &apos;/var/run/docker.sock:/var/run/docker.sock&apos;
</code></pre><p>Start docker container:</p>
<pre><code>docker-compose up 
</code></pre><p>After a couple of minutes, you can access localstack UI via: <a href="http://localhost:8055/" target="_blank" rel="noopener">http://localhost:8055/</a></p>
<p><img src="/images/aws/localstack-s3-1.png" alt="localstack"></p>
<p>And local S3 UI: <a href="http://localhost:4572/" target="_blank" rel="noopener">http://localhost:4572/</a></p>
<p>Now AWS is inside your VM!</p>
<h2 id="Working-with-localstack"><a href="#Working-with-localstack" class="headerlink" title="Working with localstack"></a>Working with localstack</h2><p>Create a bucket in localstack:</p>
<pre><code>aws --endpoint-url=http://localhost:4572 s3 mb s3://demo-bucket
</code></pre><p>NB: the –endpoint-url specifies the localstack URL for s3</p>
<p>From the localstack logs (via Docker), you will see something like:</p>
<pre><code>localstack_demo | 2019-12-06 15:10:14,909:API: 127.0.0.1 - - [06/Dec/2019 15:10:14] &quot;PUT /demo-bucket HTTP/1.1&quot; 200 -
</code></pre><p>From the localstack S3 UI, you will see:</p>
<pre><code>&lt;Buckets&gt;
    &lt;Bucket&gt;
        &lt;Name&gt;demo-bucket&lt;/Name&gt;
        &lt;CreationDate&gt;2006-02-03T16:45:09.000Z&lt;/CreationDate&gt;
    &lt;/Bucket&gt;
&lt;/Buckets&gt;
</code></pre><p>Attach an ACL to the bucket:</p>
<pre><code>aws --endpoint-url=http://localhost:4572 s3api put-bucket-acl --bucket demo-bucket --acl public-read
</code></pre><p>Now, the S3 bucket is available in the localstack dashboard.</p>
<p>Check .localstack/data/s3_api_calls.json file</p>
<pre><code>{&quot;a&quot;: &quot;s3&quot;, &quot;m&quot;: &quot;PUT&quot;, &quot;p&quot;: &quot;/demo-bucket&quot;, &quot;d&quot;: &quot;XXXXXXXX&quot;, &quot;h&quot;: {&quot;host&quot;: &quot;localhost&quot;, &quot;Accept-Encoding&quot;: &quot;identity&quot;, &quot;User-Agent&quot;: &quot;aws-cli/1.16.183 Python/3.6.9 Linux/4.15.
0-72-generic botocore/1.12.253&quot;, &quot;X-Amz-Date&quot;: &quot;20191206T151014Z&quot;, &quot;X-Amz-Content-SHA256&quot;: &quot;xxxx&quot;, &quot;Authorization&quot;: &quot;AWS4-HMAC-SHA256 Credential=XXXXXX, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=xxxx&quot;, &quot;Content-Length&quot;: &quot;153&quot;, &quot;X-Forwarded-For&quot;: &quot;172.30.0.1, 0.0.0.0:4572&quot;, &quot;content-type&quot;: &quot;binary/octet-str
eam&quot;}}
{&quot;a&quot;: &quot;s3&quot;, &quot;m&quot;: &quot;PUT&quot;, &quot;p&quot;: &quot;/demo-bucket?acl&quot;, &quot;d&quot;: &quot;&quot;, &quot;h&quot;: {&quot;host&quot;: &quot;localhost&quot;, &quot;Accept-Encoding&quot;: &quot;identity&quot;, &quot;x-amz-a
cl&quot;: &quot;public-read&quot;, &quot;User-Agent&quot;: &quot;aws-cli/1.16.183 Python/3.6.9 Linux/4.15.0-72-generic botocore/1.12.253&quot;, &quot;X-Amz-Date&quot;: &quot;
20191206T151327Z&quot;, &quot;X-Amz-Content-SHA256&quot;: &quot;xxxx&quot;, &quot;Authorizatio
n&quot;: &quot;AWS4-HMAC-SHA256 Credential=xxxx&quot;, &quot;Content-Length&quot;: &quot;
0&quot;, &quot;X-Forwarded-For&quot;: &quot;172.30.0.1, 0.0.0.0:4572&quot;, &quot;content-type&quot;: &quot;binary/octet-stream&quot;}}
</code></pre><p>Edit .env file with content:</p>
<pre><code>AWS_ACCESS_KEY_ID=&apos;123&apos; 
AWS_SECRET_KEY=&apos;xyz&apos;
AWS_BUCKET_NAME=&apos;demo-bucket&apos;
</code></pre><p>Note: it doesn’t matter what your AWS key &amp; secret are, as long as they aren’t empty.</p>
<p>Create aws.js</p>
<pre><code>const AWS = require(&apos;aws-sdk&apos;)
require(&apos;dotenv&apos;).config()

const credentials = {
   accessKeyId: process.env.AWS_ACCESS_KEY_ID,
   secretAccessKey: process.env.AWS_SECRET_KEY,
}

const useLocal = process.env.NODE_ENV !== &apos;production&apos;

const bucketName = process.env.AWS_BUCKET_NAME

const s3client = new AWS.S3({
   credentials,

   endpoint: useLocal ? &apos;http://localhost:4572&apos; : undefined,
   s3ForcePathStyle: true,
})


const uploadFile = async (data, fileName) =&gt;
   new Promise((resolve) =&gt; {
      s3client.upload(
         {
            Bucket: bucketName,
            Key: fileName,
            Body: data,
         },
         (err, response) =&gt; {
            if (err) throw err
            resolve(response)
         },
      )
   })

module.exports = uploadFile
</code></pre><p>Create test-upload.js with content:</p>
<pre><code>const fs = require(&apos;fs&apos;)
const path = require(&apos;path&apos;)
const uploadFile = require(&apos;./aws&apos;)

const testUpload = () =&gt; {
    const filePath = path.resolve(__dirname, &apos;test.jpg&apos;)
    const fileStream = fs.createReadStream(filePath)
    const now = new Date()
    const fileName = `test-image-${now.toISOString()}.jpg`
    uploadFile(fileStream, fileName).then((response) =&gt; {
        console.log(&quot;:)&quot;)
        console.log(response)
    }).catch((err) =&gt; {
        console.log(&quot;:|&quot;)
        console.log(err)
    })
}

testUpload()
</code></pre><p>To test, run:</p>
<pre><code>node test-upload.js
</code></pre><p>From the output, you can find the image location, like: </p>
<pre><code>http://localhost:4572/demo-bucket/test-image-2019-12-06T15%3A28%3A57.037Z.jpg
</code></pre><p>If check .localstack/data/s3_api_calls.json file again, you will see the file containing image binary data.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/aws-s3-localstack/" data-id="ck3udhcdj0000wh05q1k9g56l" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws/">aws</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/localstack/">localstack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/s3/">s3</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AWS/">AWS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Heroku/">Heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hyrax/">Hyrax</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ruby/">Ruby</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/">System</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ubuntu/">Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blacklight/">blacklight</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hyrax/">hyrax</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ngrok/">ngrok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/rails/">rails</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/reactjs/">reactjs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ruby/">ruby</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/samvera/">samvera</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/solr/">solr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/system/">system</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/">AWS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chart-js/">Chart.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DynamoDB/">DynamoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EC2/">EC2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elastic-IP/">Elastic IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fedora/">Fedora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IRIS/">IRIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactJS/">ReactJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSL/">SSL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Solr/">Solr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/">Tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js/">Vue.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/access-control/">access control</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/amplify/">amplify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/">aws</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blacklight/">blacklight</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blacklights/">blacklights</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/branch/">branch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/">cms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/content-blocks/">content blocks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elk/">elk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facets/">facets</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fedora/">fedora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google+</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/graphql/">graphql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hyrax/">hyrax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kibana/">kibana</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/localstack/">localstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngrok/">ngrok</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/notification/">notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/">oauth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails/">rails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refinery/">refinery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rest-api/">rest api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/s3/">s3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/samvera/">samvera</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/slack/">slack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solr/">solr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/turbolinks/">turbolinks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-js/">vue.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpacker/">webpacker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xforms/">xforms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/">zsh</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AWS/" style="font-size: 10px;">AWS</a> <a href="/tags/Chart-js/" style="font-size: 10px;">Chart.js</a> <a href="/tags/DynamoDB/" style="font-size: 10px;">DynamoDB</a> <a href="/tags/EC2/" style="font-size: 10px;">EC2</a> <a href="/tags/Elastic-IP/" style="font-size: 10px;">Elastic IP</a> <a href="/tags/Fedora/" style="font-size: 11.43px;">Fedora</a> <a href="/tags/IRIS/" style="font-size: 10px;">IRIS</a> <a href="/tags/Java/" style="font-size: 15.71px;">Java</a> <a href="/tags/ReactJS/" style="font-size: 11.43px;">ReactJS</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/Solr/" style="font-size: 12.86px;">Solr</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/Vue-js/" style="font-size: 10px;">Vue.js</a> <a href="/tags/access-control/" style="font-size: 10px;">access control</a> <a href="/tags/amplify/" style="font-size: 10px;">amplify</a> <a href="/tags/aws/" style="font-size: 15.71px;">aws</a> <a href="/tags/blacklight/" style="font-size: 12.86px;">blacklight</a> <a href="/tags/blacklights/" style="font-size: 12.86px;">blacklights</a> <a href="/tags/branch/" style="font-size: 10px;">branch</a> <a href="/tags/cms/" style="font-size: 10px;">cms</a> <a href="/tags/content-blocks/" style="font-size: 10px;">content blocks</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/elk/" style="font-size: 10px;">elk</a> <a href="/tags/facets/" style="font-size: 10px;">facets</a> <a href="/tags/fedora/" style="font-size: 14.29px;">fedora</a> <a href="/tags/git/" style="font-size: 11.43px;">git</a> <a href="/tags/google/" style="font-size: 10px;">google+</a> <a href="/tags/graphql/" style="font-size: 10px;">graphql</a> <a href="/tags/heroku/" style="font-size: 11.43px;">heroku</a> <a href="/tags/hyrax/" style="font-size: 17.14px;">hyrax</a> <a href="/tags/java/" style="font-size: 12.86px;">java</a> <a href="/tags/kibana/" style="font-size: 10px;">kibana</a> <a href="/tags/localstack/" style="font-size: 10px;">localstack</a> <a href="/tags/logstash/" style="font-size: 10px;">logstash</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/ngrok/" style="font-size: 10px;">ngrok</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/notification/" style="font-size: 10px;">notification</a> <a href="/tags/oauth/" style="font-size: 10px;">oauth</a> <a href="/tags/python/" style="font-size: 12.86px;">python</a> <a href="/tags/rails/" style="font-size: 20px;">rails</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/refinery/" style="font-size: 10px;">refinery</a> <a href="/tags/rest-api/" style="font-size: 10px;">rest api</a> <a href="/tags/ruby/" style="font-size: 14.29px;">ruby</a> <a href="/tags/s3/" style="font-size: 11.43px;">s3</a> <a href="/tags/samvera/" style="font-size: 18.57px;">samvera</a> <a href="/tags/slack/" style="font-size: 10px;">slack</a> <a href="/tags/solr/" style="font-size: 20px;">solr</a> <a href="/tags/tool/" style="font-size: 10px;">tool</a> <a href="/tags/turbolinks/" style="font-size: 10px;">turbolinks</a> <a href="/tags/vue-js/" style="font-size: 10px;">vue.js</a> <a href="/tags/webpacker/" style="font-size: 10px;">webpacker</a> <a href="/tags/xforms/" style="font-size: 10px;">xforms</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/yodl-migration/">YODL migration</a>
          </li>
        
          <li>
            <a href="/ruby-rest-api/">Build Rest API in Ruby</a>
          </li>
        
          <li>
            <a href="/tomcat-over-apache2/">Serve Tomcat application over Apache2 and SSL</a>
          </li>
        
          <li>
            <a href="/iris-migration/">IRIS migration</a>
          </li>
        
          <li>
            <a href="/react-char-js/">Use ReactJS with Chart.js</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Frank<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>