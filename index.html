<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-127329943-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Frank&#39;s development blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Frank&apos;s development blog - Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights">
<meta name="keywords" content="Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights">
<meta property="og:type" content="website">
<meta property="og:title" content="Frank&#39;s development blog">
<meta property="og:url" content="https://yfrankfeng.github.io/index.html">
<meta property="og:site_name" content="Frank&#39;s development blog">
<meta property="og:description" content="Frank&apos;s development blog - Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Frank&#39;s development blog">
<meta name="twitter:description" content="Frank&apos;s development blog - Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights">
  
    <link rel="alternate" href="/atom.xml" title="Frank&#39;s development blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Frank&#39;s development blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Java, Rails, Python, Solr, Samvera, Hyrax, Blacklights</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://yfrankfeng.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-arch1_edit_notes" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/arch1_edit_notes/" class="article-date">
  <time datetime="2019-07-07T12:40:12.000Z" itemprop="datePublished">2019-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/rails/">rails</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/arch1_edit_notes/">archbishopsregisters edit application notes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="How-edit-application-works"><a href="#How-edit-application-works" class="headerlink" title="How edit application works?"></a>How edit application works?</h2><h3 id="place-and-person-facet-on-the-left"><a href="#place-and-person-facet-on-the-left" class="headerlink" title="place and person facet on the left"></a>place and person facet on the left</h3><p>For person facet, the data is generated via new_solr_fields_controller.rb, e.g.</p>
<pre><code>entry_person_name_authority_new = get_entry_agent_array(sdoc[:id])
sdoc[&apos;entry_person_same_as_facet_ssim&apos;] = entry_person_name_authority_new
</code></pre><p>And within get_entry_agent_array method:</p>
<pre><code>preflabel_array = []
query = SolrQuery.new
q = &apos;relatedAgentFor_ssim:&apos; + id

unless id.nil?
  num = query.solr_query(q, &apos;person_same_as_tesim&apos;, 0)[&apos;response&apos;][&apos;numFound&apos;].to_i
  query.solr_query(q, &apos;person_same_as_tesim&apos;, num)[&apos;response&apos;][&apos;docs&apos;].map do |result|
    unless result[&apos;person_same_as_tesim&apos;].nil?
      result[&apos;person_same_as_tesim&apos;].each do |agent|
        query.solr_query(&apos;id:&apos; + agent, &apos;preflabel_tesim&apos;, 1)[&apos;response&apos;][&apos;docs&apos;].map do |result2|
          preflabel = result2[&apos;preflabel_tesim&apos;].join unless result2[&apos;preflabel_tesim&apos;].nil?
          preflabel_array &lt;&lt; preflabel
        end
      end
    end
  end
end

preflabel_array
</code></pre><p>Similarly for place:</p>
<pre><code>get_entry_place_array    
</code></pre><h3 id="customized-index-fields-in-NewSolrFieldsController"><a href="#customized-index-fields-in-NewSolrFieldsController" class="headerlink" title="customized index fields in NewSolrFieldsController"></a>customized index fields in NewSolrFieldsController</h3><p>The ‘modify_sdoc’ method has been used to customized which fields need to be index in solr and how to generate values for them. However, it seems that the method is a ‘God’ method, e.g. it works for all content models and makes lots of unnecessary calls for non-existing fields for some models. </p>
<pre><code>def modify_sdoc(sdoc)
......
end    
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/arch1_edit_notes/" data-id="cjyzza0yc0000z3052tvpv2dy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blacklights/">blacklights</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fedora/">fedora</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-arch1_search_notes" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/arch1_search_notes/" class="article-date">
  <time datetime="2019-07-04T12:40:12.000Z" itemprop="datePublished">2019-07-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/rails/">rails</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/arch1_search_notes/">archbishopsregisters search application notes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="How-search-works"><a href="#How-search-works" class="headerlink" title="How search works?"></a>How search works?</h2><p>The magic starts from <a href="https://github.com/digital-york/arch1_search/blob/master/app/controllers/searches_controller.rb#L79" target="_blank" rel="noopener">here</a>, e.g. the call to ‘set_search_result_arrays’ within searches_controller.rb.</p>
<p>Within <a href="https://github.com/digital-york/arch1_search/blob/master/app/controllers/concerns/solr.rb#L5" target="_blank" rel="noopener">set_search_result_arrays method</a>, the search result is built in a few steps:</p>
<p>NB: it uses lowercased search terms, as shown here:</p>
<pre><code>search_term2 = @search_term.downcase.tr(&apos; &apos;, &apos;*&apos;) 
</code></pre><p>(1) It searches all entries against the search term, e.g. </p>
<pre><code>q = &quot;has_model_ssim:Entry AND (entry_type_search:*#{search_term2}* or section_type_search:*#{search_term2}* or summary_search:*#{search_term2}* or marginalia_search:*#{search_term2}* or subject_search:*#{search_term2}* or language_search:*#{search_term2}* or note_search:*#{search_term2}* or editorial_note_search:*#{search_term2}* or is_referenced_by_search:*#{search_term2}*)&quot;
</code></pre><p>Search results will be saved in q_result and the facets will be updated.    </p>
<p>More importantly, <strong>‘entry_id_set’</strong> will be updated with entry IDs.</p>
<p><a href="https://github.com/digital-york/arch1_search/blob/master/app/controllers/concerns/solr.rb#L26-#L40" target="_blank" rel="noopener">GH Link</a></p>
<p>(2) Use same search term to search people/groups and get the object ID, e.g.</p>
<pre><code>q = &quot;has_model_ssim:RelatedAgent AND (person_same_as_search:*#{search_term2}* or person_role_search:*#{search_term2}* or person_descriptor_search:*#{search_term2}* or person_descriptor_same_as_search:*#{search_term2}* or person_note_search:*#{search_term2}* or person_same_as_search:*#{search_term2}* or person_related_place_search:*#{search_term2}* or person_related_person_search:*#{search_term2}*)&quot;
</code></pre><p>Then use the entry IDs found above (relatedAgentFor_ssim) to get entries metadata:</p>
<pre><code>result[&apos;relatedAgentFor_ssim&apos;].each do |relatedagent|
    q_result2 = query.solr_query(&quot;id:#{relatedagent}&quot;, &apos;id,has_model_ssim&apos;, 1, nil, 0, true, -1, &apos;index&apos;, facets, fq_entry)
end                        
</code></pre><p>Finally, update ‘entry_id_set’</p>
<p><a href="https://github.com/digital-york/arch1_search/blob/master/app/controllers/concerns/solr.rb#L45-#L73" target="_blank" rel="noopener">GH Link</a>    </p>
<p>(3) Place</p>
<p>Similar to (2) but use:</p>
<pre><code>has_model_ssim:RelatedPlace
</code></pre><p>(4) Dates    </p>
<p>Similar to (2) but use:</p>
<pre><code>SingleDate
</code></pre><p>(5) Data aggregation </p>
<p>To get data ready for frontend UI:</p>
<p>First, some data come from Entry object, e.g. in <a href="https://github.com/digital-york/arch1_search/blob/master/app/controllers/concerns/solr.rb#L167-#L177" target="_blank" rel="noopener">Here</a></p>
<pre><code>@element_array &lt;&lt; entry_id
get_entry_and_folio_details(entry_id)
@element_array &lt;&lt; get_element(result[&apos;entry_type_facet_ssim&apos;])
@element_array &lt;&lt; get_element(result[&apos;section_type_facet_ssim&apos;])
@element_array &lt;&lt; get_element(result[&apos;summary_tesim&apos;])
@element_array &lt;&lt; get_element(result[&apos;marginalia_tesim&apos;])
@element_array &lt;&lt; get_element(result[&apos;language_facet_ssim&apos;])
@element_array &lt;&lt; get_element(result[&apos;subject_facet_ssim&apos;])
@element_array &lt;&lt; get_element(result[&apos;note_tesim&apos;])
@element_array &lt;&lt; get_element(result[&apos;editorial_note_tesim&apos;])
@element_array &lt;&lt; get_element(result[&apos;is_referenced_by_tesim&apos;])
</code></pre><p>Second, for fields like place, people, dates, doing a second search to get data store them into the same array, e.g. @element_array</p>
<pre><code>get_places(entry_id, search_term2)
get_people(entry_id, search_term2)
get_dates(entry_id, search_term2)
</code></pre><p>Finally, store the results into @partial_list_array.</p>
<pre><code>@partial_list_array &lt;&lt; @element_array
</code></pre><p>(6) view</p>
<p>In the view page:</p>
<pre><code>&lt;% @partial_list_array.each_with_index do |t, index| %&gt;
    &lt;%
       entry_id = t[0]
       title = t[1]
       folio_id = t[2]
       entry_type = t[3]
       section_type = t[4]
       summary = t[5]
       marginalia = t[6]
       language = t[7]
       subject = t[8]
       note = t[9]
       editorial_note = t[10]
       is_referenced_by = t[11]
       place = t[12]
       person = t[13]
       dates = t[14]
    %&gt;    
</code></pre><h2 id="About-the-search-facet"><a href="#About-the-search-facet" class="headerlink" title="About the search facet"></a>About the search facet</h2><p>As defined in line 53 of new_solr_fields_controller.rb @ arch1_edit, ‘place_same_as_tesim’ is used to provide the facet data for ‘Place’ facet.</p>
<p>Therefore, if the place name authority is not synced, it will bring some <strong>strange</strong> behavior in the search APP. For example,</p>
<p>In live:</p>
<p><img src="/images/arch1_search_facet_1.png" alt=""></p>
<p>In local VM:</p>
<p><img src="/images/arch1_search_facet_2.png" alt=""></p>
<p>And no Keyby entry in local:</p>
<p><img src="/images/arch1_search_facet_3.png" alt=""></p>
<p>Therefore, in the search result page (local),</p>
<p><img src="/images/arch1_search_facet_4.png" alt=""></p>
<p>Two ways to fix this problem:</p>
<p>(1) Recommended - Sync data from live to local<br>(2) Manually add the place needed for this record and edit that record by linking the place to place authority.      </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/arch1_search_notes/" data-id="cjxpysv5h0000bh05q82kabb6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blacklights/">blacklights</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fedora/">fedora</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-solr-or-query" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/solr-or-query/" class="article-date">
  <time datetime="2019-06-28T12:40:12.000Z" itemprop="datePublished">2019-06-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/solr/">solr</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/solr-or-query/">Solr OR query problem and fix</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In Solr admin page, e.g. <a href="http://localhost:8983/solr/#/arch1_solrsync/query" target="_blank" rel="noopener">http://localhost:8983/solr/#/arch1_solrsync/query</a></p>
<p>query for individual object works but the ‘OR’ query is NOT working, e.g. queries: </p>
<pre><code>id:h702q6403
id:3b591b35w
</code></pre><p>are both working, but </p>
<pre><code>id:3b591b35w OR id:h702q6403
</code></pre><p>is NOT.</p>
<p>The quick solution is to put the following in q field:</p>
<pre><code>id:*
</code></pre><p>and in the fq field, enter:</p>
<pre><code>id:3b591b35w OR id:h702q6403
</code></pre><p>For arch1, a method can be added to app/helpers/solr_query.rb, e.g. (EXPERIMENTAL):</p>
<pre><code>def solr_query_fq(q, fq, fl=&apos;id&apos;, rows=10, sort=&apos;&apos;, start=0 )
  CONN.get &apos;select&apos;, :params =&gt; {
    :q=&gt;q,
    :fq=&gt;fq,
    :fl=&gt;fl,
    :rows=&gt;rows,
    :sort=&gt;sort,
    :start=&gt;start
  }
end  
</code></pre><p>And changes to register_folio.rb:</p>
<pre><code>q.solr_query(&apos;has_model_ssim:OrderedCollection&apos;, &apos;id&apos;)[&apos;response&apos;][&apos;docs&apos;].map.each do |result|
    collection = result[&apos;id&apos;]

    q.solr_query(&apos;id:&quot;&apos; + collection + &apos;/list_source&quot;&apos;, &apos;ordered_targets_ssim&apos;)[&apos;response&apos;][&apos;docs&apos;].map.each do |res|
        order = res[&apos;ordered_targets_ssim&apos;]
        query = &apos;&apos;
        order.each do |o|
            # to parse object id from format like: &quot;production/dz/01/0r/92/dz010r92r&quot;
            # this may be caused by the version changes of Fedora/Active Fedora
            id = (o.include? &apos;/&apos;) ? o.rpartition(&apos;/&apos;).last : o
            if query==&apos;&apos;
              query = &apos;(id:&quot;&apos; + id + &apos;&quot;&apos;
            else
              query = query + &apos; OR id:&quot;&apos; + id + &apos;&quot;&apos;
            end
        end
        query = query + &apos;)&apos;
        q.solr_query_fq(&apos;*:*&apos;, query, &apos;id,preflabel_tesim,reg_id_tesim&apos;)[&apos;response&apos;][&apos;docs&apos;].map.each do |r|
            registers[r[&apos;id&apos;]] = [r[&apos;reg_id_tesim&apos;][0], r[&apos;preflabel_tesim&apos;][0]]
        end
    end
end    
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/solr-or-query/" data-id="cjxfyf6nn0000lr05om4yawyx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-setup-archbishopsregisters" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/how-to-setup-archbishopsregisters/" class="article-date">
  <time datetime="2019-04-12T12:40:12.000Z" itemprop="datePublished">2019-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/rails/">rails</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/how-to-setup-archbishopsregisters/">How to setup archbishopsregisters</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Restore-fedora-data-from-live"><a href="#Restore-fedora-data-from-live" class="headerlink" title="Restore fedora data from live"></a>Restore fedora data from live</h2><h3 id="Get-Fedora-settings-right"><a href="#Get-Fedora-settings-right" class="headerlink" title="Get Fedora settings right"></a>Get Fedora settings right</h3><p>Stop Tomcat and clear fedora data folder</p>
<p>Edit /opt/tomcat/webapps/fedora/WEB-INF/classes/spring/repo.xml:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;
    xsi:schemaLocation=&quot;
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot;&gt;

    &lt;context:annotation-config/&gt;

    &lt;bean name=&quot;modeshapeRepofactory&quot;
        class=&quot;org.fcrepo.kernel.modeshape.spring.ModeShapeRepositoryFactoryBean&quot;
        p:repositoryConfiguration=&quot;classpath:/config/file-simple/repository.json&quot;/&gt;

    &lt;bean class=&quot;org.modeshape.jcr.ModeShapeEngine&quot; init-method=&quot;start&quot;/&gt;

    &lt;!-- For the time being, load annotation config here too --&gt;
    &lt;bean class=&quot;org.fcrepo.metrics.MetricsConfig&quot;/&gt;

    &lt;bean id=&quot;connectionManager&quot; class=&quot;org.apache.http.impl.conn.PoolingHttpClientConnectionManager&quot; /&gt;
&lt;/beans&gt;
</code></pre><p>and edit file: /opt/tomcat/webapps/fedora/WEB-INF/classes/config/file-simple/repository.json</p>
<pre><code>{
    &quot;name&quot; : &quot;repo&quot;,
    &quot;jndiName&quot; : &quot;&quot;,
    &quot;workspaces&quot; : {
        &quot;predefined&quot; : [&quot;default&quot;],
        &quot;default&quot; : &quot;default&quot;,
        &quot;allowCreation&quot; : true,
        &quot;cacheSize&quot; : 10000
    },
    &quot;storage&quot; : {
        &quot;persistence&quot;: {
            &quot;type&quot;: &quot;file&quot;,
            &quot;path&quot; : &quot;${fcrepo.object.directory:target/objects}&quot;
        },
        &quot;binaryStorage&quot; : {
            &quot;type&quot; : &quot;file&quot;,
            &quot;directory&quot; : &quot;${fcrepo.binary.directory:target/binaries}&quot;,
            &quot;minimumBinarySizeInBytes&quot; : 4096
        }
    },
    &quot;security&quot; : {
        &quot;anonymous&quot; : {
            &quot;roles&quot; : [&quot;readonly&quot;,&quot;readwrite&quot;,&quot;admin&quot;],
            &quot;useOnFailedLogin&quot; : false
        },
        &quot;providers&quot; : [
            { &quot;classname&quot; : &quot;org.fcrepo.auth.common.BypassSecurityServletAuthenticationProvider&quot; }
        ]
    },
    &quot;garbageCollection&quot; : {
        &quot;threadPool&quot; : &quot;modeshape-gc&quot;,
        &quot;initialTime&quot; : &quot;00:00&quot;,
        &quot;intervalInHours&quot; : 24
    },
    &quot;node-types&quot; : [&quot;/home/frank/fcrepo-data/fedora-node-types/fedora-node-types.cnd&quot;]
}
</code></pre><p>Restart Tomcat.</p>
<p>Actually, the config file being used is defined in the environment variables, run the following command to find it out:</p>
<pre><code>ps -aef | grep java
</code></pre><p>Copy data (opal-fedora474-475-backup.2019-05-02-20190514T143512Z-001.zip) from <a href="https://drive.google.com/drive/folders/1w3c0AObfp24NvB2vGgtaQJSVEy8gduEJ" target="_blank" rel="noopener">Google Drive</a>, and unzip it to local folder.</p>
<p>Run the following command to restore data:</p>
<pre><code>curl -X POST -d &quot;/var/tmp/opal-fedora474-475-backup.2019-05-02&quot; &quot;localhost:8080/fedora/rest/fcr:restore&quot;
</code></pre><p>It should take 2 minutes to complete.    </p>
<h3 id="Use-fcrepo-wrapper-as-a-reference"><a href="#Use-fcrepo-wrapper-as-a-reference" class="headerlink" title="Use fcrepo_wrapper as a reference"></a>Use fcrepo_wrapper as a reference</h3><p>If the above steps are not working, can use fcrepo_wrapper as a reference and copy its config files</p>
<p>Get a copy of arch1_search and run within the app folder:</p>
<pre><code>bundle exec fcrepo_wrapper
</code></pre><p>It will load fedora on port 8984, and create a temporary folder like: /tmp/fcrepo-webapp-4.7.5-jetty-console.jar_8984</p>
<p>Go to that folder and check file webapp/WEB-INF/classes/spring/repo.xml, find modeshapeRepofactory setting:</p>
<pre><code>&lt;bean name=&quot;modeshapeRepofactory&quot;
      class=&quot;org.fcrepo.kernel.modeshape.spring.ModeShapeRepositoryFactoryBean&quot;
      p:repositoryConfiguration=&quot;classpath:/config/file-simple/repository.json&quot;/&gt;
</code></pre><h2 id="Reindex-all-fedora-data-to-Solr"><a href="#Reindex-all-fedora-data-to-Solr" class="headerlink" title="Reindex all fedora data to Solr"></a>Reindex all fedora data to Solr</h2><p>Clear solr data</p>
<h3 id="Option-1-not-fully-working-left-around-1000-objects-not-indexed"><a href="#Option-1-not-fully-working-left-around-1000-objects-not-indexed" class="headerlink" title="Option 1 (not fully working - left around 1000 objects not indexed)"></a>Option 1 (not fully working - left around 1000 objects not indexed)</h3><p>In arch1_edit rails console (development), run:</p>
<pre><code>ActiveFedora::Base.reindex_everything
</code></pre><p>It takes 1-2 hours to index everything! (BUT in some cases, it’s not fully working, e.g. stopped in the middle.)</p>
<h3 id="Option-2"><a href="#Option-2" class="headerlink" title="Option 2"></a>Option 2</h3><p>In <strong>arch1</strong> (NOT arch1_search because some classes are missing there) app, run</p>
<pre><code>rake sync_solr:sync
</code></pre><p>It will index all objects</p>
<h2 id="Get-arch1-working"><a href="#Get-arch1-working" class="headerlink" title="Get arch1 working"></a>Get arch1 working</h2><p>The arch1 won’t work in this point, e.g. while loading the app, it shows: </p>
<pre><code>ArgumentError in LoginController#index
wrong number of arguments (given 0, expected 1)
</code></pre><p>The above error occured because the qa gem has changed their interface, e.g. :    </p>
<p>In 0.5.0 (current arch1 uses), <a href="https://github.com/samvera/questioning_authority/blob/v0.5.0/lib/qa/authorities/web_service_base.rb" target="_blank" rel="noopener">https://github.com/samvera/questioning_authority/blob/v0.5.0/lib/qa/authorities/web_service_base.rb</a></p>
<p>There is NO response method. However, in later version (from 0.9.0 to 4.1.1), the response method looks like:</p>
<p>In <a href="https://github.com/samvera/questioning_authority/blob/v4.1.1/lib/qa/authorities/web_service_base.rb#L27-L29" target="_blank" rel="noopener">https://github.com/samvera/questioning_authority/blob/v4.1.1/lib/qa/authorities/web_service_base.rb#L27-L29</a></p>
<pre><code>def response(url)
  Faraday.get(url) { |req| req.headers[&apos;Accept&apos;] = &apos;application/json&apos; }
end
</code></pre><p>Comment out the above code seems working, but not sure what’s the consequences of this change.<br>Maybe fork from official QA gem and make this change, then declare in the Gemfile:</p>
<p>UPDATE: it seems that arch1 is NOT using QA gem, at least in the above feature, so maybe it can be removed.</p>
<h2 id="Get-arch1-search-fully-working"><a href="#Get-arch1-search-fully-working" class="headerlink" title="Get arch1_search fully working"></a>Get arch1_search fully working</h2><p><del>## Initialize arch1_edit</del></p>
<p>There are two seperate applications, sharing the same Solr instance.</p>
<p>First get a local copy of <a href="https://github.com/digital-york/arch1" target="_blank" rel="noopener">arch1_edit</a>, </p>
<p>Switch to branch: ‘update-rails-5’</p>
<p>Configure Fedora / Solr in the .env</p>
<p>Run:</p>
<pre><code>bundle install
rake db:migrate
#rake db:schema:load
</code></pre><p>and run the following rake tasks:</p>
<pre><code>rake persons:add_persons
</code></pre><p>You will see this error:</p>
<pre><code>Concept Scheme ... 
ERROR in ConceptScheme!
RSolr::Error::Http - 400 Bad Request
Error: &apos;undefined field preflabel_tesim&apos;,

URI: http://localhost:8983/solr/arch1/select?wt=ruby&amp;q=preflabel_tesim%3A%22people%22+AND+has_model_ssim%3A%22ConceptScheme%22&amp;fl=id&amp;rows=1&amp;start=0
</code></pre><p>Copy schema.xml and solrconfig.xml from <a href="https://github.com/digital-york/arch1/tree/master/solr_conf/conf" target="_blank" rel="noopener">https://github.com/digital-york/arch1/tree/master/solr_conf/conf</a>, and save them into solr config folder, e.g. /var/solr/data/arch1/conf</p>
<p>Also add the following lines to schema.xml:</p>
<pre><code>&lt;dynamicField name=&quot;*_search&quot; type=&quot;text_en&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;true&quot; /&gt;
&lt;dynamicField name=&quot;*_facet&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;true&quot; /&gt;
</code></pre><p>Restart Solr:</p>
<pre><code>sudo systemctl restart solr
</code></pre><p>And run this rake task again:</p>
<pre><code>rake persons:add_persons
</code></pre><p><del>You will see that some entries are created, together with some error messages.</del><br>In Persons_01_02_16.csv, remove the ? in the first line can make the script running successfully.</p>
<pre><code>CHANGE 
    ? Richard; R. as written, 
TO 
    Richard; R. as written,
</code></pre><p>Run other rake tasks:</p>
<pre><code>rake places:add_places
</code></pre><p>and </p>
<pre><code>rake places:load_places                    
</code></pre><p>You will see lots of exceptions, mainly because of the following bugs:</p>
<p>1) The ‘/‘ is missing in <a href="https://github.com/digital-york/arch1/blob/master/lib/tasks/places.rake#L25" target="_blank" rel="noopener">this line</a>, The code should be:</p>
<pre><code>arr = CSV.read(Rails.root + &apos;lib/assets/lists/places/&apos; + l)    
</code></pre><p>2) Lots of exception checks are missing, e.g. for this line:</p>
<pre><code>auth.search(q).each do |a|
</code></pre><p>It would be better to check exception first:</p>
<pre><code>unless auth.search(q).nil?
  auth.search(q).each do |a|        
</code></pre><p>The full patched file is <a href="https://gist.github.com/yf508/fbb397917e91cc2ed5d164548137f9dc" target="_blank" rel="noopener">here</a></p>
<p>Run this rake task:</p>
<pre><code>rake persons:add_groups      
</code></pre><p>It doesn’t add any group, needs investigation (maybe due to some missing Fedora objects)</p>
<p>Run:<br>    rake concepts:load_terms<br>    rake concepts:load_subjects</p>
<p>The above 2 tasks are stable and shouldn’t produce any problem.</p>
<p>Run: </p>
<pre><code>rake regfols:reg_order
</code></pre><p>You may see the following error:</p>
<pre><code>uninitialized constant ActiveFedora::Aggregation::ListSource
</code></pre><p>It was caused by the backwards compatibility issue between active-fedora 10.3.0 and 9.7.0. It was fixed <a href="https://github.com/digital-york/arch1/commit/4d1e8f1646da7d40bcff877cc24d2a6ebbb83a47" target="_blank" rel="noopener">here</a></p>
<p>Run:<br>    rake regfols:fol_order[‘Abp_Reg_31.csv’,’qv33rw85n’]<br>    rake regfols:fol_order[‘Abp_Reg_32.csv’,’w3763685q’]</p>
<p>The above ‘Abp_Reg_32.csv’ can be found from lib/assets/new_regs_and_fols<br>The above ‘qv33rw85n’ can be get from Rails console, e.g. run within Rails console:</p>
<pre><code>regs = Register.all
regs[0]
regs[1]
etc...
</code></pre><h2 id="Start-arch1-search"><a href="#Start-arch1-search" class="headerlink" title="Start arch1_search"></a>Start arch1_search</h2><p>Run:</p>
<pre><code>rails s -b 0.0.0.0 
</code></pre><p>Access:</p>
<pre><code>http://localhost:3000
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/how-to-setup-archbishopsregisters/" data-id="cjvpaprz60000a205zjceio3s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blacklights/">blacklights</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fedora/">fedora</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ngrok" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/ngrok/" class="article-date">
  <time datetime="2019-04-12T12:40:12.000Z" itemprop="datePublished">2019-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ngrok/">ngrok</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/ngrok/">Amazing dev tool - ngrok</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://ngrok.com/" target="_blank" rel="noopener">ngrok</a> is a tool to provide public URLs for:</p>
<ul>
<li>testing your application through any NAT or firewall.</li>
<li>sending preview to your client.</li>
<li>exposing your local server.</li>
<li>building web hook integration.</li>
<li>SSH access to your Rasberry PI.</li>
</ul>
<p>Installation is very easy:</p>
<p>Just download from <a href="https://ngrok.com/download" target="_blank" rel="noopener">here</a>, unzip, and run:</p>
<pre><code>./ngrok http 3000
</code></pre><p>You will see something like below:</p>
<p><img src="/images/ngrok.jpg" alt="ngrok"> </p>
<p>Enjoy accessing to <a href="http://xxxxxx.ngrok.io" target="_blank" rel="noopener">http://xxxxxx.ngrok.io</a> from anywhere!</p>
<p>An alternative is <a href="https://serveo.net/" target="_blank" rel="noopener">serveo</a>, even no need to install, just run:</p>
<pre><code>ssh -R 80:localhost:3000 serveo.net
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/ngrok/" data-id="cjudyfgav0000u9053lu15bo4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ngrok/">ngrok</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tool/">tool</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-vuejs" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/vuejs/" class="article-date">
  <time datetime="2019-04-10T12:40:12.000Z" itemprop="datePublished">2019-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/vuejs/">vuejs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/vuejs/">Vue.js pros &amp; cons</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I have been exploring Vue.js framework and here is what I’ve found:</p>
<p>The following discussion is based on Vue.js but some points should apply to React.js &amp; AngularJS as well.</p>
<h2 id="What-is-Vue-js"><a href="#What-is-Vue-js" class="headerlink" title="What is Vue.js?"></a>What is Vue.js?</h2><p>Vue.js is a progressive framework for building frontend applications. Vues is perfectly capable of building complex Single-Page Applications (SPA).</p>
<p>The comparison among Vue.js, React.js, AngularJS, Ember and other frameworks:</p>
<p><a href="https://vuejs.org/v2/guide/comparison.html" target="_blank" rel="noopener">https://vuejs.org/v2/guide/comparison.html</a></p>
<h2 id="What-Vue-js-is-good-at"><a href="#What-Vue-js-is-good-at" class="headerlink" title="What Vue.js is good at?"></a>What Vue.js is good at?</h2><ul>
<li>Build SPAs</li>
<li>Can work well with existing projects, e.g. migrating existing JS code to Vue.js step by step.</li>
</ul>
<h2 id="Benefits-of-using-Vue-js"><a href="#Benefits-of-using-Vue-js" class="headerlink" title="Benefits of using Vue.js?"></a>Benefits of using Vue.js?</h2><ul>
<li>It’s very easy to use: for any developer familiar with JS, they can pick up Vue.js quickly.</li>
<li>Smoother integration: while introducing Vue.js into an existing project, it’s possible to start form a smaller part without affecting to the whole application.</li>
<li>Good performance: pages load faster when user navigates within application.</li>
<li>Well-written documentation</li>
</ul>
<h2 id="Cons-of-Vue-js"><a href="#Cons-of-Vue-js" class="headerlink" title="Cons of Vue.js?"></a>Cons of Vue.js?</h2><ul>
<li>SEO: SEO optimization can be less effective as search engine crawlers work better with distinct pages.</li>
<li>SPAs require user to have JS turned on so it may not work in some browsers</li>
<li>Long time running SPAs may have potential memory leaks which will slow down SPAs and event make it crash.</li>
<li>While running in mobile devices, SPAs can drain battery power faster than MPAs.</li>
<li>Vue.js currently has no stable way to develop mobile applications. The core team is working with Weex and NativeScript to make it happen.</li>
</ul>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://vuejs.org/v2/guide/" target="_blank" rel="noopener">https://vuejs.org/v2/guide/</a><br><a href="https://dev.to/gentlemanoi/the-progressive-javascript-framework-4kc" target="_blank" rel="noopener">https://dev.to/gentlemanoi/the-progressive-javascript-framework-4kc</a><br><a href="https://www.quora.com/What-are-the-pros-and-cons-between-SPA-and-MPA" target="_blank" rel="noopener">https://www.quora.com/What-are-the-pros-and-cons-between-SPA-and-MPA</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/vuejs/" data-id="cjub2wlv40000wn05e9td9h0r" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue-js/">Vue.js</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-build-samvera-stack-step-by-step" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/build-samvera-stack-step-by-step/" class="article-date">
  <time datetime="2019-04-03T12:40:12.000Z" itemprop="datePublished">2019-04-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/samvera/">samvera</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/build-samvera-stack-step-by-step/">Build Samvera stack step by step</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Environments"><a href="#Environments" class="headerlink" title="Environments"></a>Environments</h2><p>Ubuntu: 18.04.1 LTS<br>Java: OpenJDK version 11<br>Tomcat: 9.0.12<br>Solr: 7.5.0<br>Fedora: 4.5.1<br>Ruby: 2.5.3<br>Rails: 5.2.1</p>
<h2 id="Install-OpenJDK-version-11"><a href="#Install-OpenJDK-version-11" class="headerlink" title="Install OpenJDK version 11"></a>Install OpenJDK version 11</h2><pre><code>sudo apt install default-jdk

sudo nano /etc/environment
</code></pre><p>Add: </p>
<pre><code>JAVA_HOME=&quot;/usr/lib/jvm/java-11-openjdk-amd64&quot;
</code></pre><h2 id="Install-Tomcat-9-0-12-as-a-service"><a href="#Install-Tomcat-9-0-12-as-a-service" class="headerlink" title="Install Tomcat 9.0.12 as a service"></a>Install Tomcat 9.0.12 as a service</h2><p>This part is mainly following this <a href="https://www.digitalocean.com/community/tutorials/install-tomcat-9-ubuntu-1804" target="_blank" rel="noopener">post</a></p>
<pre><code>sudo groupadd tomcat
sudo useradd -s /bin/false -g tomcat -d /opt/tomcat tomcat
cd /tmp
curl -O http://mirror.ox.ac.uk/sites/rsync.apache.org/tomcat/tomcat-9/v9.0.12/bin/apache-tomcat-9.0.12-deployer.tar.gz
sudo mkdir /opt/tomcat
sudo tar xzvf apache-tomcat-9*tar.gz -C /opt/tomcat --strip-components=1
cd /opt/tomcat
sudo chgrp -R tomcat /opt/tomcat
sudo chmod -R g+r conf
sudo chmod g+x conf
sudo chown -R tomcat webapps/ work/ temp/ logs/
</code></pre><p>Then create a Tomcat service:</p>
<pre><code>sudo nano /etc/systemd/system/tomcat.service
</code></pre><p>With following content:</p>
<pre><code>[Unit]
Description=Apache Tomcat Web Application Container
After=network.target

[Service]
Type=forking

Environment=JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
Environment=CATALINA_PID=/opt/tomcat/temp/tomcat.pid
Environment=CATALINA_HOME=/opt/tomcat
Environment=CATALINA_BASE=/opt/tomcat
Environment=&apos;CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC&apos;
Environment=&apos;JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom&apos;

ExecStart=/opt/tomcat/bin/startup.sh
ExecStop=/opt/tomcat/bin/shutdown.sh

User=tomcat
Group=tomcat
UMask=0007
RestartSec=10
Restart=always

[Install]
WantedBy=multi-user.target
</code></pre><p>Reload system daemon:</p>
<pre><code>sudo systemctl daemon-reload
</code></pre><p>Start Tomcat:</p>
<pre><code>sudo systemctl start tomcat
</code></pre><p>Test if you can access Tomcat via port 8080, then enable this service:</p>
<pre><code>sudo systemctl enable tomcat
</code></pre><p>Configure Tomcat web admin UI:</p>
<pre><code>sudo nano /opt/tomcat/conf/tomcat-users.xml
</code></pre><p>With the content:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;tomcat-users xmlns=&quot;http://tomcat.apache.org/xml&quot;
              xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
              xsi:schemaLocation=&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;
              version=&quot;1.0&quot;&gt;
  &lt;role rolename=&quot;manager-gui&quot;/&gt;
  &lt;user username=&quot;tomcat&quot; password=&quot;PASSWORD&quot; roles=&quot;manager-gui&quot;/&gt;

  &lt;role rolename=&quot;admin-gui&quot;/&gt;
  &lt;user username=&quot;admin&quot; password=&quot;PASSWORD&quot; roles=&quot;admin-gui&quot;/&gt;
&lt;/tomcat-users&gt;              
</code></pre><p>By default, Tomcat adds IP restrictions for Manager UI, either comment it out or add your IP into the list.</p>
<pre><code>sudo nano /opt/tomcat/webapps/manager/META-INF/context.xml
</code></pre><p>And restart Tomcat</p>
<h2 id="Install-Solr-7-5-0-as-a-service"><a href="#Install-Solr-7-5-0-as-a-service" class="headerlink" title="Install Solr 7.5.0 as a service"></a>Install Solr 7.5.0 as a service</h2><pre><code>cd /tmp
wget http://www.apache.org/dyn/closer.lua/lucene/solr/7.5.0/solr-7.5.0.tgz
tar xvf solr-7.5.0.tgz
cd solr-7.5.0/bin
./install_solr_service.sh  ../../solr-7.5.0.tgz
sudo su - solr -c &quot;/opt/solr/bin/solr create -c oasis -n data_driven_schema_configs&quot;
</code></pre><p>Test: </p>
<pre><code>sudo service solr status
</code></pre><p><strong>Optional</strong>: if using Hyrax, you need to tweak solr configuration files, e.g. Copy solrconfig.xml, schema.xml from <a href="https://github.com/digital-york/arch1/tree/master/solr_conf/conf" target="_blank" rel="noopener">https://github.com/digital-york/arch1/tree/master/solr_conf/conf</a> to /var/solr/data/oasis/conf</p>
<h2 id="Install-Fedora-4-5-1"><a href="#Install-Fedora-4-5-1" class="headerlink" title="Install Fedora 4.5.1"></a>Install Fedora 4.5.1</h2><p>Create folder and change permissions:</p>
<pre><code>mkdir /home/frank/fcrepo-data
mkdir /home/frank/fcrepo-data/fedora-node-types
sudo chmod -R 755 /home/frank/fcrepo-data
sudo chown -R tomcat:tomcat /home/frank/fcrepo-data
</code></pre><p>And</p>
<pre><code>sudo nano /home/frank/fcrepo-data/fedora-node-types/fedora-node-types.cnd
</code></pre><p>content is available in: <a href="https://github.com/digital-york/fedora-config/blob/master/fedora-node-types.cnd" target="_blank" rel="noopener">https://github.com/digital-york/fedora-config/blob/master/fedora-node-types.cnd</a></p>
<pre><code>cd /opt/tomcat/webapps
wget https://github.com/fcrepo4/fcrepo4/releases/download/fcrepo-4.5.1/fcrepo-webapp-4.5.1.war -O fedora.war
</code></pre><p>Edit file /opt/tomcat/bin/setclasspath.sh</p>
<pre><code>JAVA_OPTS=&quot;${JAVA_OPTS} -Dfcrepo.home=/home/frank/fcrepo-data&quot;
JAVA_OPTS=&quot;${JAVA_OPTS} -Dfuseki.port=3131&quot;
JAVA_OPTS=&quot;${JAVA_OPTS} -Dfile.serializer.dir=/home/frank/fcrepo-data/files -Dfcrepo.modeshape.configuration=classpath:/config/minimal/repository.json&quot;
CATALINA_OPTS=&quot;$CATALINA_OPTS -server -Xms512m -Xmx1024m&quot;
JAVA_HOME=&quot;/usr/lib/jvm/java-11-openjdk-amd64&quot;

sudo nano /opt/tomcat/webapps/fedora/WEB-INF/classes/config/minimal/repository.json
</code></pre><p>Update: “node-types” : [“/home/frank/fcrepo-data/fedora-node-types/fedora-node-types.cnd”]</p>
<p>NB: <strong>fedora won’t work with jdk 11</strong> as the jaxb jar has been removed from JDK11.<br>Quick &amp; dirty fix is to download jaxb jar and copy it to fedora webapp/WEB-INF/lib</p>
<p>Restart Tomcat</p>
<h2 id="Install-Ruby-on-Rails"><a href="#Install-Ruby-on-Rails" class="headerlink" title="Install Ruby on Rails"></a>Install Ruby on Rails</h2><h3 id="rbenv"><a href="#rbenv" class="headerlink" title="rbenv"></a>rbenv</h3><pre><code>cd
git clone git://github.com/sstephenson/rbenv.git .rbenv                       
echo &apos;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&apos; &gt;&gt; ~/.bash_profile
echo &apos;eval &quot;$(rbenv init -)&quot;&apos; &gt;&gt; ~/.bash_profile
git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
echo &apos;export PATH=&quot;$HOME/.rbenv/plugins/ruby-build/bin:$PATH&quot;&apos; &gt;&gt; ~/.bash_profile
source ~/.bash_profile
</code></pre><h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><pre><code>rbenv install -v 2.5.3
rbenv global 2.5.3
ruby -v
</code></pre><h3 id="gems"><a href="#gems" class="headerlink" title="gems"></a>gems</h3><pre><code>echo &quot;gem: --no-document&quot; &gt; ~/.gemrc
gem install bundler
gem install rails
</code></pre><h2 id="Install-other-components"><a href="#Install-other-components" class="headerlink" title="Install other components"></a>Install other components</h2><h3 id="Clamav"><a href="#Clamav" class="headerlink" title="Clamav"></a>Clamav</h3><pre><code>sudo apt-get install clamav
sudo apt-get install libclamav-dev
gem install clamav -v &apos;0.4.1&apos; --source &apos;https://rubygems.org/&apos;
</code></pre><h3 id="Postgresql-gem"><a href="#Postgresql-gem" class="headerlink" title="Postgresql gem"></a>Postgresql gem</h3><pre><code>sudo apt-get install libpq-dev
</code></pre><h3 id="Sqlite3"><a href="#Sqlite3" class="headerlink" title="Sqlite3"></a>Sqlite3</h3><pre><code>sudo apt-get install sqlite3 libsqlite3-dev
</code></pre><h3 id="libreoffice"><a href="#libreoffice" class="headerlink" title="libreoffice"></a>libreoffice</h3><pre><code>sudo apt install software-properties-common
sudo add-apt-repository ppa:libreoffice/ppa
sudo apt-get update
sudo apt-get install libreoffice
</code></pre><h3 id="FITS"><a href="#FITS" class="headerlink" title="FITS"></a>FITS</h3><pre><code>sudo apt-get install imagemagick
sudo apt-get install libmediainfo-dev
sudo apt-get install libzen-dev 

cd ~
wget http://projects.iq.harvard.edu/files/fits/files/fits-0.10.2.zip
sudo unzip ~/fits-0.10.2.zip -d /opt
sudo chmod a+x /opt/fits-0.10.2/fits.sh
</code></pre><p>Add /opt/fits-0.10.2/ into PATH, e.g. in .bash_profile</p>
<pre><code>sudo ln -s /opt/fits-0.10.2 /opt/fits
</code></pre><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><pre><code>sudo apt-get install redis-server
</code></pre><h2 id="Hyrax-2-4-0"><a href="#Hyrax-2-4-0" class="headerlink" title="Hyrax 2.4.0"></a>Hyrax 2.4.0</h2><p>Install rails 5.1.6, as required by Hyrax 2.4.0 (PS: it seems that rails 5.2.1 is not working with Hyrax 2.4.0)</p>
<pre><code>gem install rails -v 5.1.6
</code></pre><p>Create Hyrax demo project</p>
<pre><code>rails _5.1.6_ new hyraxdemo -m https://raw.githubusercontent.com/samvera/hyrax/v2.4.0/template.rb
</code></pre><p>Run Hyrax:</p>
<pre><code>bin/rails hydra:server    
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/build-samvera-stack-step-by-step/" data-id="cjo7eats30001s105tt2cg35z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blacklight/">blacklight</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fedora/">fedora</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hyrax/">hyrax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-work-on-git-branches" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/work-on-git-branches/" class="article-date">
  <time datetime="2019-04-01T12:40:12.000Z" itemprop="datePublished">2019-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/git/">git</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/work-on-git-branches/">Work on git branches</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Pull-maybe-fetch-master-branch"><a href="#Pull-maybe-fetch-master-branch" class="headerlink" title="Pull (maybe fetch?) master branch:"></a>Pull (maybe fetch?) master branch:</h4><pre><code>git pull origin master
</code></pre><h4 id="Create-feature-branch"><a href="#Create-feature-branch" class="headerlink" title="Create feature branch"></a>Create feature branch</h4><pre><code>git checkout -b mybranch
</code></pre><h4 id="Work-on-feature-branch"><a href="#Work-on-feature-branch" class="headerlink" title="Work on feature branch"></a>Work on feature branch</h4><p>Make sure the final commit is buildable and passes all tests.</p>
<h4 id="Find-the-last-commit-your-branch-branches-from"><a href="#Find-the-last-commit-your-branch-branches-from" class="headerlink" title="Find the last commit your branch branches from"></a>Find the last commit your branch branches from</h4><pre><code>git log --graph --decorate --pretty=oneline --abbrev-commit
</code></pre><h4 id="Squash-to-1-commit"><a href="#Squash-to-1-commit" class="headerlink" title="Squash to 1 commit"></a>Squash to 1 commit</h4><pre><code>git rebase -i [SHA]
</code></pre><p>Edit commits in the interactive mode.</p>
<h4 id="Push-featured-branch-to-remote"><a href="#Push-featured-branch-to-remote" class="headerlink" title="Push featured branch to remote"></a>Push featured branch to remote</h4><pre><code>git push origin mybranch 
</code></pre><p>OR</p>
<pre><code>git push origin mybranch --force-with-lease
</code></pre><h4 id="Merge-into-master"><a href="#Merge-into-master" class="headerlink" title="Merge into master"></a>Merge into master</h4><pre><code>git checkout master
git merge mybranch
git push origin master
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/work-on-git-branches/" data-id="cju1efk9l0000r205yjzo1egj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/branch/">branch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-make-featured-work-working" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/how-to-make-featured-work-working/" class="article-date">
  <time datetime="2019-04-01T12:40:12.000Z" itemprop="datePublished">2019-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hyrax/">hyrax</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/how-to-make-featured-work-working/">How to make featured work working in Hyrax</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Tests-in-Rails-console"><a href="#Tests-in-Rails-console" class="headerlink" title="Tests in Rails console"></a>Tests in Rails console</h2><p>The following code will make a work showing the featured works list on homgepage.</p>
<pre><code>fw = FeaturedWork.new(&apos;work_id&apos;: &apos;ng451h485&apos;)
fw.save
</code></pre><h2 id="How-to-make-it-working-in-Hyrax"><a href="#How-to-make-it-working-in-Hyrax" class="headerlink" title="How to make it working in Hyrax"></a>How to make it working in Hyrax</h2><p>As shown in <a href="https://github.com/samvera/hyrax/blob/master/app/presenters/hyrax/work_show_presenter.rb#L157" target="_blank" rel="noopener">here</a>, only when</p>
<ul>
<li>user can feature works</li>
<li>solr_document.public is true</li>
</ul>
<p>The work is featurable.</p>
<p>For example: login as admin and the work is public then the work is featurable.</p>
<p>There is also a bug with featured work, and here is my pull request: <a href="https://github.com/samvera/hyrax/pull/3776" target="_blank" rel="noopener">https://github.com/samvera/hyrax/pull/3776</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/how-to-make-featured-work-working/" data-id="cjtybi8v60000py0505y6brkk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UI/">UI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hyrax/">hyrax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/samvera/">samvera</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-make-all-resources-public" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/how-to-make-all-resources-public/" class="article-date">
  <time datetime="2019-04-01T12:40:12.000Z" itemprop="datePublished">2019-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hyrax/">hyrax</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/how-to-make-all-resources-public/">How to make all resources public in Hyrax</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In most projects I’m working on, all objects are available to public - therefore the visibility feature in Hyrax is not needed. Here is how to remove it from an application:</p>
<h2 id="form-visibility-component-html-erb"><a href="#form-visibility-component-html-erb" class="headerlink" title="_form_visibility_component.html.erb"></a>_form_visibility_component.html.erb</h2><p>Copy this file from Hyrax codebase, and make changes:</p>
<pre><code>&lt;fieldset&gt;
  &lt;legend class=&quot;legend-save-work&quot;&gt;Visibility&lt;/legend&gt;
  &lt;%
    is_public = true
  %&gt;
  &lt;ul class=&quot;visibility&quot;&gt;
    &lt;li class=&quot;radio&quot;&gt;
      &lt;label&gt;
        &lt;%= f.radio_button :visibility, Hydra::AccessControls::AccessRight::VISIBILITY_TEXT_VALUE_PUBLIC, data: { &apos;target&apos;: &apos;#collapsePublic&apos; }, :checked=&gt;is_public %&gt;
        &lt;%= visibility_badge(Hydra::AccessControls::AccessRight::VISIBILITY_TEXT_VALUE_PUBLIC) %&gt;
        &lt;br /&gt;
        &lt;%= t(&apos;hyrax.visibility.open.note_html&apos;, type: f.object.human_readable_type) %&gt;
        &lt;div class=&quot;collapse&quot; id=&quot;collapsePublic&quot;&gt;
          &lt;%= t(&apos;hyrax.visibility.open.warning_html&apos;, label: visibility_badge(Hydra::AccessControls::AccessRight::VISIBILITY_TEXT_VALUE_PUBLIC)) %&gt;
        &lt;/div&gt;
      &lt;/label&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/fieldset&gt;
</code></pre><h2 id="Hide-visibility-DIV-in-the-form"><a href="#Hide-visibility-DIV-in-the-form" class="headerlink" title="Hide visibility DIV in the form"></a>Hide visibility DIV in the form</h2><p>Since ‘public’ is the only option now, so no need to display it in the form. To hide it: </p>
<p>Copy ‘_form_progress.html.erb’ from Hyrax and update this following code:</p>
<pre><code>&lt;div class=&quot;set-access-controls list-group-item visibility-widget&quot;&gt;
  &lt;%= render &apos;form_visibility_component&apos;, f: f %&gt;
&lt;/div&gt;
</code></pre><p>The CSS class ‘visibility-widget’ just hide the whole block:</p>
<pre><code>.visibility-widget {
  display: none;
}
</code></pre><h2 id="xxxx-form-rb"><a href="#xxxx-form-rb" class="headerlink" title="xxxx_form.rb"></a>xxxx_form.rb</h2><p>In the form file, e.g. xxxx_form.rb , add the following code:</p>
<pre><code>def self.build_permitted_params
    super + [
        :visibility
    ]
end
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://yfrankfeng.github.io/how-to-make-all-resources-public/" data-id="cjty7jr3200005o05dkw0n4yh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/access-control/">access control</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hyrax/">hyrax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/samvera/">samvera</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Heroku/">Heroku</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hyrax/">Hyrax</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ubuntu/">Ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blacklight/">blacklight</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hyrax/">hyrax</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ngrok/">ngrok</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/rails/">rails</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/samvera/">samvera</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/solr/">solr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vuejs/">vuejs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js/">Vue.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/access-control/">access control</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blacklight/">blacklight</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blacklights/">blacklights</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/branch/">branch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cms/">cms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facets/">facets</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fedora/">fedora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google+</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hyrax/">hyrax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngrok/">ngrok</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/">oauth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails/">rails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refinery/">refinery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/samvera/">samvera</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solr/">solr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-js/">vue.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpacker/">webpacker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/">zsh</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/Vue-js/" style="font-size: 10px;">Vue.js</a> <a href="/tags/access-control/" style="font-size: 10px;">access control</a> <a href="/tags/blacklight/" style="font-size: 13.33px;">blacklight</a> <a href="/tags/blacklights/" style="font-size: 13.33px;">blacklights</a> <a href="/tags/branch/" style="font-size: 10px;">branch</a> <a href="/tags/cms/" style="font-size: 10px;">cms</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/facets/" style="font-size: 10px;">facets</a> <a href="/tags/fedora/" style="font-size: 15px;">fedora</a> <a href="/tags/git/" style="font-size: 11.67px;">git</a> <a href="/tags/google/" style="font-size: 10px;">google+</a> <a href="/tags/heroku/" style="font-size: 11.67px;">heroku</a> <a href="/tags/hyrax/" style="font-size: 16.67px;">hyrax</a> <a href="/tags/java/" style="font-size: 11.67px;">java</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/ngrok/" style="font-size: 10px;">ngrok</a> <a href="/tags/oauth/" style="font-size: 10px;">oauth</a> <a href="/tags/rails/" style="font-size: 20px;">rails</a> <a href="/tags/refinery/" style="font-size: 10px;">refinery</a> <a href="/tags/samvera/" style="font-size: 18.33px;">samvera</a> <a href="/tags/solr/" style="font-size: 20px;">solr</a> <a href="/tags/tool/" style="font-size: 10px;">tool</a> <a href="/tags/vue-js/" style="font-size: 10px;">vue.js</a> <a href="/tags/webpacker/" style="font-size: 10px;">webpacker</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/arch1_edit_notes/">archbishopsregisters edit application notes</a>
          </li>
        
          <li>
            <a href="/arch1_search_notes/">archbishopsregisters search application notes</a>
          </li>
        
          <li>
            <a href="/solr-or-query/">Solr OR query problem and fix</a>
          </li>
        
          <li>
            <a href="/how-to-setup-archbishopsregisters/">How to setup archbishopsregisters</a>
          </li>
        
          <li>
            <a href="/ngrok/">Amazing dev tool - ngrok</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Frank<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>